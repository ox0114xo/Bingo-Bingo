<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Bingo Bingo å°Šæ¦®æ•¸æ“šçµ‚ç«¯</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background: #0F172A; color: #F1F5F9; font-family: -apple-system, sans-serif; -webkit-tap-highlight-color: transparent; }
        .tc-gold { color: #FACC15; }
        .bg-gold { background: linear-gradient(135deg, #FACC15 0%, #EAB308 100%); color: #000; }
        .card { background: rgba(30, 41, 59, 0.8); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.05); border-radius: 20px; }
        .num-btn { aspect-ratio: 1; border-radius: 10px; background: rgba(255,255,255,0.05); display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 0.85rem; border: 1px solid transparent; }
        .num-btn.selected { background: #EF4444; border-color: #FACC15; box-shadow: 0 0 15px rgba(239, 68, 68, 0.4); }
        .ball { width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.7rem; font-weight: 900; background: #334155; color: #FACC15; border: 1px solid #475569; }
        .nav-active { color: #FACC15; border-bottom: 3px solid #FACC15; font-weight: 900; }
        input, select { background: rgba(0,0,0,0.3) !important; border: 1px solid rgba(255,255,255,0.1) !important; color: white !important; }
    </style>
</head>
<body class="pb-10">

    <nav class="sticky top-0 z-50 bg-[#0F172A]/90 backdrop-blur border-b border-white/5">
        <div class="flex justify-around p-3 text-xs font-bold text-gray-400">
            <button onclick="show('bet')" id="t-bet" class="nav-active pb-1">æŠ•æ³¨å°ç</button>
            <button onclick="show('hist')" id="t-hist" class="pb-1">é–‹çç´€éŒ„</button>
            <button onclick="show('stats')" id="t-stats" class="pb-1">æ•¸æ“šå†·ç†±</button>
        </div>
        <div class="bg-red-600 px-4 py-1 flex justify-between items-center text-white">
            <span id="bonus-on" class="hidden text-[10px] font-black animate-pulse">ğŸ’° æ˜¥ç¯€åŠ ç¢¼ä¸­</span>
            <span class="text-[10px] font-bold">NEXT DRAW: <span id="timer" class="text-xl ml-2">--:--</span></span>
        </div>
    </nav>

    <div class="max-w-md mx-auto p-4 space-y-6">

        <section id="sec-bet" class="space-y-4">
            <div class="card p-5 space-y-6">
                <div class="grid grid-cols-3 gap-1 bg-black/40 p-1 rounded-xl">
                    <button onclick="setMode('star')" id="m-star" class="py-2 text-xs font-bold rounded-lg bg-white/10">æ˜Ÿè™Ÿ</button>
                    <button onclick="setMode('bs')" id="m-bs" class="py-2 text-xs font-bold rounded-lg text-gray-500">å¤§å°</button>
                    <button onclick="setMode('oe')" id="m-oe" class="py-2 text-xs font-bold rounded-lg text-gray-500">å–®é›™</button>
                </div>

                <div class="grid grid-cols-2 gap-3 p-4 bg-black/30 rounded-2xl border border-white/5">
                    <div class="space-y-1">
                        <label class="text-[10px] text-gray-500 font-bold">é–‹çæœŸæ•¸</label>
                        <input type="text" id="start-p" oninput="syncByP(this.value)" class="w-full rounded-lg p-2 text-lg font-black text-yellow-400 text-center">
                    </div>
                    <div class="space-y-1">
                        <label class="text-[10px] text-gray-500 font-bold">é–‹çæ™‚é–“</label>
                        <input type="time" id="start-t" oninput="syncByT(this.value)" class="w-full rounded-lg p-2 text-lg font-black text-center">
                    </div>
                    <button onclick="setNext()" class="col-span-2 text-[10px] bg-white/5 py-2 rounded-lg font-bold border border-white/10">é è¨­ä¸‹ä¸€æœŸé–‹ç</button>
                </div>

                <div id="picker-star" class="space-y-3">
                    <div class="flex justify-between text-[10px] font-black text-gray-400"><span>1-80 é¸è™Ÿå€</span><span id="sel-info" class="text-red-400">å·²é¸ 0 å€‹</span></div>
                    <div id="num-grid" class="grid grid-cols-8 gap-1.5"></div>
                </div>

                <div id="picker-other" class="hidden grid grid-cols-2 gap-2">
                    <button onclick="pickOpt('å¤§')" class="opt py-4 border border-white/10 rounded-xl font-bold">å¤§</button>
                    <button onclick="pickOpt('å°')" class="opt py-4 border border-white/10 rounded-xl font-bold">å°</button>
                </div>

                <div class="grid grid-cols-3 gap-2">
                    <div class="space-y-1"><label class="text-[10px] font-bold text-gray-500">ç©æ³•</label>
                        <select id="stars" class="w-full rounded-lg p-3 text-xs font-bold text-yellow-500"><option value="3">3æ˜Ÿ</option><option value="4">4æ˜Ÿ</option><option value="5">5æ˜Ÿ</option><option value="10">10æ˜Ÿ</option></select>
                    </div>
                    <div class="space-y-1"><label class="text-[10px] font-bold text-gray-500">å€æ•¸</label><input type="number" id="mult" value="4" class="w-full rounded-lg p-3 text-xs text-center font-bold"></div>
                    <div class="space-y-1"><label class="text-[10px] font-bold text-gray-500">é€£çºŒæœŸæ•¸</label><input type="number" id="cons" value="10" class="w-full rounded-lg p-3 text-xs text-center font-bold"></div>
                </div>

                <button onclick="doCheck()" class="w-full py-5 rounded-2xl bg-gold font-black text-xl shadow-lg active:scale-95 transition">ğŸ¯ é–‹å§‹å°ç</button>
            </div>
            <div id="res-box" class="hidden card p-5 border-l-8 border-yellow-500"></div>
        </section>

        <section id="sec-hist" class="hidden space-y-4">
            <div class="flex justify-between items-center px-2">
                <h3 class="text-xs font-black text-gray-500">LATEST RESULTS</h3>
                <input type="date" id="hist-date" onchange="filterHist(this.value)" class="text-[10px] p-1 rounded-md">
            </div>
            <div id="history-list" class="space-y-4"></div>
        </section>

        <section id="sec-stats" class="hidden space-y-4 text-center">
            <div class="card p-5 space-y-4">
                <h3 class="font-black text-orange-400 italic">DATA INTELLIGENCE</h3>
                <div class="flex gap-2 justify-center mb-4">
                    <button onclick="sortStats('gap')" class="text-[10px] bg-white/10 px-3 py-1 rounded-full border border-white/10">æŒ‰éºæ¼æ’åº</button>
                    <button onclick="sortStats('hot')" class="text-[10px] bg-white/10 px-3 py-1 rounded-full border border-white/10">æŒ‰ç†±åº¦æ’åº</button>
                </div>
                <div id="stats-board" class="grid grid-cols-4 gap-2"></div>
            </div>
        </section>
    </div>

    <script>
        const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vR7ZS9Nt-Y0kMHr_6lNy5FcMeYRn1_MVkmN_E3SuFDSxm7QkVT76NmeLkCWJNrR24U8XVtdTtn8IQc3/pub?gid=1857522434&single=true&output=csv";
        const ANCHOR_P = 115011765;
        let db = []; let sel = []; let mode = 'star'; let curOpt = null;

        function init() {
            const g = document.getElementById('num-grid');
            for(let i=1; i<=80; i++) {
                let b = document.createElement('button'); b.innerText = String(i).padStart(2,'0'); b.className = "num-btn";
                b.onclick = () => {
                    const lim = parseInt(document.getElementById('stars').value);
                    if(sel.includes(i)) { sel = sel.filter(x=>x!==i); b.classList.remove('selected'); }
                    else if(sel.length < lim) { sel.push(i); b.classList.add('selected'); }
                    document.getElementById('sel-info').innerText = `å·²é¸ ${sel.length} / ${lim}`;
                }; g.appendChild(b);
            }
            refresh(); setInterval(timer, 1000);
        }

        function syncByP(p) {
            if(p.length < 9) return;
            let d = new Date(2026, 1, 27, 23, 10);
            d.setMinutes(d.getMinutes() + (parseInt(p) - ANCHOR_P) * 5);
            document.getElementById('start-t').value = ("0"+d.getHours()).slice(-2) + ":" + ("0"+d.getMinutes()).slice(-2);
        }

        function syncByT(t) {
            let [h, m] = t.split(':').map(Number);
            let now = new Date(); now.setHours(h, m, 0, 0);
            let anchor = new Date(2026, 1, 27, 23, 10);
            let diff = Math.round((now - anchor) / (5 * 60 * 1000));
            document.getElementById('start-p').value = ANCHOR_P + diff;
        }

        function setNext() {
            let now = new Date();
            let anchor = new Date(2026, 1, 27, 23, 10);
            let diff = Math.ceil((now - anchor) / (5 * 60 * 1000));
            let p = ANCHOR_P + diff;
            document.getElementById('start-p').value = p;
            syncByP(String(p));
        }

        async function refresh() {
            try {
                const r = await fetch(CSV_URL + "&t=" + Date.now());
                const csv = await r.text();
                // ğŸ’ æ”¹é€² CSV è§£æï¼Œç¢ºä¿ 20 é¡†çƒéƒ½è¢«è®€å–
                db = csv.split('\n').slice(1).filter(l => l.trim()).map(l => {
                    const parts = l.match(/(".*?"|[^",\s]+)(?=\s*,|\s*$)/g);
                    if(!parts) return null;
                    const id = parts[0].trim();
                    const time = parts[1].trim();
                    const nums = parts[2].replace(/"/g,'').split(',').map(n => parseInt(n.trim())).filter(n => !isNaN(n));
                    const bonus = parts[3] && parts[3].includes("åŠ ç¢¼");
                    return { id, time, nums, bonus };
                }).filter(x => x && x.nums.length === 20);
                
                render();
                if(!document.getElementById('start-p').value) setNext();
                document.getElementById('bonus-on').classList.toggle('hidden', !db[0]?.bonus);
            } catch (e) { console.error(e); }
        }

        function render() {
            let h = '';
            db.slice(0, 15).forEach(d => {
                let balls = d.nums.map(n => `<div class="ball">${String(n).padStart(2,'0')}</div>`).join('');
                h += `<div class="bg-black/20 p-4 rounded-2xl border border-white/5 space-y-3">
                    <div class="flex justify-between items-center text-[10px] font-black text-gray-500">
                        <span>æœŸæ•¸ ${d.id} | ğŸ•’ ${d.time}</span>
                        ${d.bonus ? '<span class="bg-gold px-1 rounded text-black text-[8px]">åŠ ç¢¼</span>' : ''}
                    </div>
                    <div class="grid grid-cols-10 gap-1">${balls}</div>
                </div>`;
            });
            document.getElementById('history-list').innerHTML = h;
            sortStats('hot');
        }

        function sortStats(type) {
            let counts = {}; let gaps = {}; for(let i=1; i<=80; i++) { counts[i]=0; gaps[i]=-1; }
            db.forEach((d, idx) => d.nums.forEach(n => { counts[n]++; if(gaps[n] === -1) gaps[n] = idx; }));
            
            let arr = Object.keys(counts).map(n => ({ n, hot: counts[n], gap: gaps[n] }));
            if(type === 'gap') arr.sort((a,b) => b.gap - a.gap);
            else arr.sort((a,b) => b.hot - a.hot);

            document.getElementById('stats-board').innerHTML = arr.slice(0, 20).map(x => `
                <div class="p-2 bg-white/5 rounded-xl border border-white/5">
                    <div class="text-[10px] text-yellow-500 font-black">${String(x.n).padStart(2,'0')}</div>
                    <div class="text-[9px] text-gray-400">éºæ¼: ${x.gap}æœŸ</div>
                    <div class="text-[9px] text-red-400">é–‹ç: ${x.hot}æ¬¡</div>
                </div>
            `).join('');
        }

        function timer() {
            let n = new Date(); let m = 4 - (n.getMinutes() % 5); let s = 59 - n.getSeconds();
            document.getElementById('timer').innerText = `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
        }

        function show(id) {
            ['bet','hist','stats'].forEach(x => {
                document.getElementById(`sec-${x}`).classList.toggle('hidden', x !== id);
                document.getElementById(`t-${x}`).classList.toggle('nav-active', x === id);
            });
        }
        function setMode(m) {
            mode = m;
            document.getElementById('picker-star').classList.toggle('hidden', m !== 'star');
            document.getElementById('picker-other').classList.toggle('hidden', m === 'star');
            document.querySelectorAll('#m-star, #m-bs, #m-oe').forEach(b => {
                b.classList.remove('bg-white/10','text-white'); b.classList.add('text-gray-500');
            });
            document.getElementById(`m-${m}`).classList.add('bg-white/10','text-white');
        }
        window.onload = init;
    </script>
</body>
</html>

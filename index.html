<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bingo Bingo Vercel çµ‚ç«¯</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .tc-red { color: #E63946; }
        .tc-bg-red { background-color: #E63946; }
        .tc-bg-dark { background-color: #0A1931; }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 font-sans">

    <div class="tc-bg-dark text-white p-4 shadow-md sticky top-0 z-50">
        <h1 class="text-2xl font-bold text-center mb-2">ğŸ° Bingo Bingo æ™ºèƒ½çµ‚ç«¯</h1>
        <div class="flex justify-center items-center gap-4 text-xl">
            <span>â³ ä¸‹æœŸé–‹çå€’æ•¸ï¼š</span>
            <span id="timer" class="text-yellow-400 font-mono font-bold text-2xl">--:--</span>
        </div>
    </div>

    <div class="max-w-4xl mx-auto p-4 space-y-6 mt-4">
        
        <div id="status-box" class="p-3 rounded-lg bg-gray-200 text-center font-bold">
            ğŸ”„ æ­£åœ¨é€£ç·šè®€å–æœ€æ–°é–‹çè³‡æ–™...
        </div>

        <div class="bg-white p-4 rounded-xl shadow border-t-4 border-red-500">
            <h2 class="text-xl font-bold mb-4 tc-red border-b pb-2">ğŸ“Š æœ€æ–°é–‹çè™Ÿç¢¼</h2>
            <div id="draws-container" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                </div>
        </div>

        <div class="bg-white p-4 rounded-xl shadow border-t-4 border-blue-900">
            <h2 class="text-xl font-bold mb-4 text-blue-900 border-b pb-2">ğŸ“ æŠ•æ³¨èˆ‡å°çè©¦ç®— (æ˜Ÿè™Ÿç©æ³•)</h2>
            
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4">
                <div>
                    <label class="block text-sm font-bold mb-1">ç©æ³•(æ˜Ÿæ•¸)</label>
                    <select id="star-select" class="w-full border p-2 rounded">
                        <option value="1">1 æ˜Ÿ</option><option value="2">2 æ˜Ÿ</option><option value="3" selected>3 æ˜Ÿ</option>
                        <option value="4">4 æ˜Ÿ</option><option value="5">5 æ˜Ÿ</option><option value="6">6 æ˜Ÿ</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-bold mb-1">å€æ•¸</label>
                    <input type="number" id="multiplier" value="4" min="1" class="w-full border p-2 rounded">
                </div>
                <div>
                    <label class="block text-sm font-bold mb-1">é€£çºŒæœŸæ•¸</label>
                    <input type="number" id="draw-counts" value="10" min="1" class="w-full border p-2 rounded">
                </div>
                <div>
                    <label class="block text-sm font-bold mb-1">èµ·å§‹æœŸæ•¸</label>
                    <input type="text" id="start-draw" placeholder="ä¾‹: 113000123" class="w-full border p-2 rounded">
                </div>
            </div>
            
            <div class="mb-4">
                <label class="block text-sm font-bold mb-1">è¼¸å…¥è™Ÿç¢¼ (ä»¥é€—è™Ÿåˆ†éš”ï¼Œä¾‹å¦‚: 5,12,66)</label>
                <input type="text" id="user-numbers" placeholder="è¼¸å…¥é¸è™Ÿ..." class="w-full border p-2 rounded border-blue-900">
            </div>

            <button onclick="calculatePrize()" class="tc-bg-red text-white font-bold py-3 px-4 rounded w-full hover:bg-red-700 transition">
                ğŸ¯ ç«‹å³å°ç
            </button>
            
            <div id="result-box" class="mt-4 p-4 rounded-lg hidden"></div>
        </div>
    </div>

    <script>
        // å€’æ•¸è¨ˆæ™‚å™¨é‚è¼¯
        function updateTime() {
            let now = new Date();
            let min = now.getMinutes();
            let nextMin = Math.ceil((min + 1) / 5) * 5;
            let remainMin = nextMin - min - 1;
            let remainSec = 60 - now.getSeconds();
            if(remainSec === 60) { remainMin += 1; remainSec = 0; }
            document.getElementById('timer').innerText = 
                String(remainMin).padStart(2, '0') + ":" + String(remainSec).padStart(2, '0');
        }
        setInterval(updateTime, 1000); updateTime();

        // æ ¸å¿ƒè³‡æ–™èˆ‡çé‡‘è¡¨
        let globalBingoData = [];
        const PRIZE_TABLE = {
            1: {1: 50}, 2: {2: 75}, 3: {3: 500, 2: 50}, 4: {4: 1000, 3: 100, 2: 25},
            5: {5: 7500, 4: 500, 3: 50}, 6: {6: 25000, 5: 1000, 4: 200, 3: 25}
        };

        // å¾ Vercel API æŠ“å–è³‡æ–™
        async function fetchBingoData() {
            try {
                // å‘¼å«åŒç¶²åŸŸä¸‹çš„ api/bingo.py Serverless å‡½æ•¸
                const response = await fetch('/api/bingo');
                const result = await response.json();
                
                if(result.success && result.data.length > 0) {
                    globalBingoData = result.data;
                    document.getElementById('status-box').className = "p-3 rounded-lg bg-green-100 text-green-800 text-center font-bold";
                    document.getElementById('status-box').innerHTML = `ğŸŸ¢ é€£ç·šæ­£å¸¸ | å·²å–å¾—æœ€æ–° ${globalBingoData.length} æœŸè³‡æ–™`;
                    
                    // è‡ªå‹•å¡«å…¥æœ€æ–°ä¸€æœŸä½œç‚ºé è¨­èµ·å§‹æœŸæ•¸
                    document.getElementById('start-draw').value = globalBingoData[globalBingoData.length - 1].draw_id;

                    // æ¸²æŸ“è™Ÿç¢¼å¡ç‰‡
                    let html = '';
                    globalBingoData.slice(0, 6).forEach(draw => {
                        let nums = draw.numbers.map(n => String(n).padStart(2, '0')).join(', ');
                        html += `<div class="p-3 border rounded-lg bg-gray-50"><div class="font-bold tc-red">ç¬¬ ${draw.draw_id} æœŸ <span class="text-xs text-gray-500 font-normal ml-2">${draw.time}</span></div><div class="mt-2 text-lg font-mono tracking-widest">${nums}</div></div>`;
                    });
                    document.getElementById('draws-container').innerHTML = html;
                } else {
                    throw new Error("API ç„¡å›å‚³æœ‰æ•ˆè³‡æ–™");
                }
            } catch (error) {
                document.getElementById('status-box').className = "p-3 rounded-lg bg-red-100 text-red-800 text-center font-bold";
                document.getElementById('status-box').innerHTML = `ğŸ”´ ç¶²è·¯ç•°å¸¸æˆ–é­åˆ°é˜»æ“‹ï¼Œè«‹ç¨å¾Œé‡è©¦ã€‚`;
            }
        }

        // å°çè¨ˆç®—é‚è¼¯
        function calculatePrize() {
            const star = parseInt(document.getElementById('star-select').value);
            const mult = parseInt(document.getElementById('multiplier').value);
            const counts = parseInt(document.getElementById('draw-counts').value);
            const startId = parseInt(document.getElementById('start-draw').value);
            const userNums = document.getElementById('user-numbers').value.split(',').map(n => parseInt(n.trim())).filter(n => !isNaN(n));

            const resBox = document.getElementById('result-box');
            resBox.classList.remove('hidden');

            if(userNums.length !== star) {
                resBox.className = "mt-4 p-4 rounded-lg bg-red-100 text-red-800 border border-red-300";
                resBox.innerHTML = `âš ï¸ éŒ¯èª¤ï¼šæ‚¨é¸æ“‡äº† ${star} æ˜Ÿç©æ³•ï¼Œä½†è¼¸å…¥äº† ${userNums.length} å€‹è™Ÿç¢¼ã€‚`;
                return;
            }

            let totalPrize = 0;
            let matchLog = [];

            for(let i=0; i<counts; i++) {
                let targetId = String(startId + i);
                let drawData = globalBingoData.find(d => d.draw_id === targetId);
                if(drawData) {
                    let matched = userNums.filter(n => drawData.numbers.includes(n));
                    let basePrize = (PRIZE_TABLE[star][matched.length] || 0);
                    let finalPrize = basePrize * mult;
                    totalPrize += finalPrize;
                    matchLog.push(`<div class="border-b py-2 flex justify-between"><span>ç¬¬ ${targetId} æœŸï¼šä¸­ ${matched.length} å€‹</span> <span class="font-bold text-red-600">$${finalPrize}</span></div>`);
                }
            }

            let totalCost = 25 * mult * counts;
            let profit = totalPrize - totalCost;
            let profitHtml = profit > 0 ? `<span class="text-green-600 font-bold">æ·¨è³º $${profit}</span>` : `<span class="text-red-600 font-bold">æ·¨æ $${profit}</span>`;

            resBox.className = "mt-4 p-4 rounded-lg bg-blue-50 border border-blue-200";
            resBox.innerHTML = `
                <h3 class="font-bold text-lg mb-2">å°ççµç®— (æˆæœ¬: $${totalCost})</h3>
                <div class="text-2xl font-bold mb-4">ç¸½ç²å¾—çé‡‘ï¼š<span class="tc-red">$${totalPrize}</span> (${profitHtml})</div>
                <div class="h-48 overflow-y-auto bg-white p-2 rounded text-sm">${matchLog.join('') || 'æ‰¾ä¸åˆ°å°æ‡‰æœŸæ•¸çš„è³‡æ–™'}</div>
            `;
        }

        // ç¶²é è¼‰å…¥å¾Œé¦¬ä¸ŠæŠ“è³‡æ–™ï¼Œä¸¦ä¸”æ¯ 60 ç§’èƒŒæ™¯åˆ·æ–°
        fetchBingoData();
        setInterval(fetchBingoData, 60000);
    </script>
</body>
</html>


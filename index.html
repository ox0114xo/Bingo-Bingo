<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Bingo Bingo æ•¸æ“šçµ‚ç«¯ V2</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background: #0F172A; color: #F1F5F9; font-family: sans-serif; }
        .bg-gold { background: linear-gradient(135deg, #FACC15 0%, #EAB308 100%); color: #000; }
        .card { background: rgba(30, 41, 59, 0.8); border: 1px solid rgba(255,255,255,0.05); border-radius: 20px; }
        .ball-grid { display: grid; grid-template-columns: repeat(10, 1fr); gap: 4px; }
        .ball { aspect-ratio: 1; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.7rem; font-weight: 900; background: #334155; color: #FACC15; border: 1px solid #475569; }
        /* è¶…ç´šçè™Ÿå°ˆå±¬é¡è‰² */
        .ball-super { background: #EF4444 !important; color: white !important; border-color: #F87171 !important; box-shadow: 0 0 8px rgba(239, 68, 68, 0.5); }
        .nav-item.active { color: #FACC15; border-bottom: 3px solid #FACC15; font-weight: 900; }
        input, select { background: #1E293B !important; color: white !important; border: 1px solid #334155 !important; border-radius: 8px !important; }
        .num-btn.selected { background: #3B82F6 !important; border-color: #60A5FA !important; transform: scale(1.1); }
        .super-btn.selected { background: #EF4444 !important; border-color: #FACC15 !important; transform: scale(1.1); box-shadow: 0 0 10px rgba(239, 68, 68, 0.5); }
    </style>
</head>
<body class="pb-10">

    <nav class="sticky top-0 z-50 bg-[#0F172A]/95 backdrop-blur shadow-2xl">
        <div class="flex justify-around p-3 text-xs font-bold text-gray-500">
            <button onclick="show('bet')" id="t-bet" class="nav-item active pb-1">æŠ•æ³¨å°ç</button>
            <button onclick="show('hist')" id="t-hist" class="nav-item pb-1">é–‹çç´€éŒ„</button>
            <button onclick="show('stats')" id="t-stats" class="nav-item pb-1">æ•¸æ“šå¤§ç›¤</button>
        </div>
        <div id="countdown-bar" class="bg-red-600 px-4 py-1.5 flex justify-between items-center text-white">
            <span class="text-[10px] font-black italic">BINGO COUNTDOWN</span>
            <span id="timer" class="text-2xl font-black font-mono">--:--</span>
        </div>
    </nav>

    <div class="max-w-md mx-auto p-4 space-y-6">
        <section id="sec-bet" class="space-y-4">
            <div class="card p-5 space-y-6">
                <div class="grid grid-cols-2 gap-3 p-4 bg-black/40 rounded-2xl border border-white/5">
                    <div>
                        <label class="text-[10px] text-gray-500 block mb-1 font-bold">é–‹çæ—¥æœŸ</label>
                        <input type="date" id="start-d" onchange="syncFromDateTime()" class="w-full p-2 text-center text-sm font-bold">
                    </div>
                    <div>
                        <label class="text-[10px] text-gray-500 block mb-1 font-bold">æ™‚é–“é¸æ“‡</label>
                        <select id="start-t" onchange="syncFromDateTime()" class="w-full p-2 text-center text-sm font-bold"></select>
                    </div>
                    <div class="col-span-2">
                        <label class="text-[10px] text-gray-500 block mb-1 font-bold">é–‹çæœŸæ•¸</label>
                        <input type="text" id="start-p" oninput="syncFromPeriod()" class="w-full p-2 text-center text-yellow-400 font-black text-lg tracking-widest">
                    </div>
                </div>

                <div>
                    <label class="text-xs font-bold text-gray-400 mb-2 block flex justify-between">
                        <span>ğŸ”µ ä¸€èˆ¬é¸è™Ÿ</span>
                        <span id="bet-count" class="text-blue-400">å·²é¸ 0 å€‹</span>
                    </label>
                    <div class="grid grid-cols-8 gap-1.5" id="num-grid"></div>
                </div>

                <div class="pt-4 border-t border-white/5">
                    <label class="text-xs font-bold text-red-400 mb-2 block flex justify-between">
                        <span>ğŸ”´ è¶…ç´šçè™Ÿé æ¸¬ (å¯ä¸é¸)</span>
                        <span id="super-val" class="text-red-500">æœªé¸æ“‡</span>
                    </label>
                    <div class="grid grid-cols-8 gap-1.5" id="super-grid"></div>
                </div>

                <div class="grid grid-cols-3 gap-2 text-center">
                    <div>
                        <label class="text-[10px] font-bold text-gray-400 mb-1 block">ç©æ³•</label>
                        <select id="stars" class="w-full p-3 text-xs font-bold text-yellow-500">
                            <option value="1">1æ˜Ÿ</option><option value="2">2æ˜Ÿ</option><option value="3" selected>3æ˜Ÿ</option>
                            <option value="4">4æ˜Ÿ</option><option value="5">5æ˜Ÿ</option><option value="6">6æ˜Ÿ</option>
                            <option value="7">7æ˜Ÿ</option><option value="8">8æ˜Ÿ</option><option value="9">9æ˜Ÿ</option><option value="10">10æ˜Ÿ</option>
                        </select>
                    </div>
                    <div>
                        <label class="text-[10px] font-bold text-gray-400 mb-1 block">å€æ•¸</label>
                        <input type="number" id="mult" value="1" min="1" class="w-full p-3 text-xs text-center font-bold">
                    </div>
                    <div>
                        <label class="text-[10px] font-bold text-gray-400 mb-1 block">é€£çºŒæœŸæ•¸</label>
                        <input type="number" id="cons" value="1" min="1" class="w-full p-3 text-xs text-center font-bold">
                    </div>
                </div>
                <button onclick="runCheck()" class="w-full py-4 rounded-xl bg-gold font-black text-lg shadow-lg active:scale-95 transition">ğŸ¯ ç«‹å³å°ç</button>
            </div>
            <div id="res-box" class="hidden card p-5 border-t-4 border-yellow-500"></div>
        </section>

        <section id="sec-hist" class="hidden space-y-4">
            <div class="card p-4 flex items-center justify-between gap-4">
                <span class="text-sm font-bold text-gray-400">é¸æ“‡æ—¥æœŸ</span>
                <input type="date" id="hist-d" onchange="renderHistory()" class="flex-1 p-2 text-center font-bold">
            </div>
            <div id="history-list" class="space-y-4"></div>
        </section>

        <section id="sec-stats" class="hidden space-y-4">
            <div class="card p-4">
                <table class="w-full text-left text-xs">
                    <thead><tr class="text-gray-500 border-b border-white/10"><th class="py-2">è™Ÿç¢¼</th><th onclick="renderStats('gap')">éºæ¼ â†•</th><th onclick="renderStats('hot')">æ¬¡æ•¸ â†•</th></tr></thead>
                    <tbody id="stats-list" class="divide-y divide-white/5"></tbody>
                </table>
            </div>
        </section>
    </div>

    <script>
        const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vR7ZS9Nt-Y0kMHr_6lNy5FcMeYRn1_MVkmN_E3SuFDSxm7QkVT76NmeLkCWJNrR24U8XVtdTtn8IQc3/pub?gid=1857522434&single=true&output=csv";
        const BASE_DATE = new Date(2026, 0, 1);
        const BASE_PERIOD = 115000001;
        let db = []; 
        let sel = [];
        let superSel = null;

        function init() {
            // ç”Ÿæˆæ™‚é–“é¸å–®
            const st = document.getElementById('start-t');
            for(let h=7; h<=23; h++){
                for(let m=0; m<60; m+=5){
                    if(h===7 && m<5) continue; if(h===23 && m>55) continue;
                    let ts = `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}`;
                    st.add(new Option(ts, ts));
                }
            }
            
            // ç”Ÿæˆä¸€èˆ¬è™Ÿç¢¼ç¶²æ ¼
            const g = document.getElementById('num-grid');
            for(let i=1; i<=80; i++) {
                let b = document.createElement('button'); 
                b.innerText = String(i).padStart(2,'0'); 
                b.className = "aspect-square rounded-lg bg-[#1E293B] border border-[#334155] font-bold text-[10px] text-gray-400";
                b.onclick = () => toggleNum(i, b);
                g.appendChild(b);
            }

            // ç”Ÿæˆè¶…ç´šçè™Ÿç¶²æ ¼
            const sg = document.getElementById('super-grid');
            for(let i=1; i<=80; i++) {
                let b = document.createElement('button'); 
                b.innerText = String(i).padStart(2,'0'); 
                b.className = "aspect-square rounded-lg bg-[#1E293B] border border-[#334155] font-bold text-[10px] text-red-900";
                b.onclick = () => toggleSuper(i, b);
                sg.appendChild(b);
            }

            refresh(); 
            setInterval(timer, 1000);
        }

        function toggleNum(i, btn) {
            const lim = parseInt(document.getElementById('stars').value);
            if(sel.includes(i)) {
                sel = sel.filter(x => x !== i);
                btn.classList.remove('num-btn', 'selected');
            } else if(sel.length < lim) {
                sel.push(i);
                btn.classList.add('num-btn', 'selected');
            }
            document.getElementById('bet-count').innerText = `å·²é¸ ${sel.length} å€‹`;
        }

        function toggleSuper(i, btn) {
            document.querySelectorAll('#super-grid button').forEach(b => b.classList.remove('super-btn', 'selected'));
            if(superSel === i) {
                superSel = null;
                document.getElementById('super-val').innerText = "æœªé¸æ“‡";
            } else {
                superSel = i;
                btn.classList.add('super-btn', 'selected');
                document.getElementById('super-val').innerText = `å·²é¸ ${String(i).padStart(2,'0')}`;
            }
        }

        async function refresh() {
            try {
                const r = await fetch(CSV_URL + "&t=" + Date.now());
                const csv = await r.text();
                db = csv.split('\n').slice(1).filter(l => l.trim()).map(l => {
                    const p = l.match(/(".*?"|[^",\s]+)(?=\s*,|\s*$)/g);
                    if(!p || p.length < 5) return null;
                    return { date: p[0], id: p[1], time: p[2], nums: p[3].replace(/"/g,'').split(',').map(n => parseInt(n.trim())), super: parseInt(p[4]), bonus: p[5].includes("åŠ ç¢¼") };
                }).filter(x => x && x.nums.length === 20);
                
                if(db.length > 0) {
                    const latestDate = db[0].date;
                    document.getElementById('hist-d').value = latestDate;
                    document.getElementById('start-d').value = latestDate;
                    document.getElementById('start-p').value = db[0].id;
                    syncFromPeriod();
                }
                renderHistory();
            } catch (e) {}
        }

        function renderHistory() {
            const filterDate = document.getElementById('hist-d').value;
            let h = ''; 
            const filtered = db.filter(x => x.date === filterDate);
            
            filtered.forEach(d => {
                let balls = d.nums.map(n => {
                    const isSuper = n === d.super;
                    return `<div class="ball ${isSuper ? 'ball-super' : ''}">${String(n).padStart(2,'0')}</div>`;
                }).join('');
                
                h += `<div class="bg-black/30 p-4 rounded-2xl border border-white/5 space-y-3">
                    <div class="flex justify-between items-center text-[10px] font-black text-gray-500">
                        <span>${d.date} | æœŸæ•¸ ${d.id} | ğŸ•’ ${d.time}</span>
                        ${d.bonus ? '<span class="bg-gold px-1.5 rounded text-black font-black text-[8px]">åŠ ç¢¼</span>' : ''}
                    </div>
                    <div class="ball-grid">${balls}</div>
                    <div class="text-[10px] text-red-500 font-bold">è¶…ç´šçè™Ÿ: ${String(d.super).padStart(2,'0')}</div>
                </div>`;
            });
            document.getElementById('history-list').innerHTML = h || `<div class='text-center p-10 text-gray-500'>${filterDate} ç„¡é–‹çç´€éŒ„</div>`;
        }

        function runCheck() {
            const startP = parseInt(document.getElementById('start-p').value);
            const cons = parseInt(document.getElementById('cons').value);
            const star = parseInt(document.getElementById('stars').value);
            if (sel.length !== star) { alert(`è«‹é¸æ»¿ ${star} å€‹è™Ÿç¢¼`); return; }

            const box = document.getElementById('res-box');
            box.classList.remove('hidden');
            let html = `<div class="font-black text-yellow-500 mb-2 text-lg">å°çå ±å‘Š</div>`;
            
            for (let i = 0; i < cons; i++) {
                let tid = (startP + i).toString();
                let r = db.find(x => x.id === tid);
                if (r) {
                    let hits = sel.filter(n => r.nums.includes(n));
                    let superHit = superSel === r.super;
                    html += `<div class="mb-3 p-3 bg-black/30 rounded-lg border border-white/5">
                        <div class="text-xs font-bold text-gray-400">æœŸæ•¸ ${tid}</div>
                        <div class="text-sm font-bold ${hits.length >= 1 ? 'text-green-400' : 'text-gray-500'}">
                            ä¸€èˆ¬å‘½ä¸­: ${hits.length} çƒ (${hits.join(', ') || 'ç„¡'})
                        </div>
                        <div class="text-sm font-bold ${superHit ? 'text-red-500' : 'text-gray-500'}">
                            è¶…ç´šçè™Ÿ: ${superHit ? 'â­ å‘½ä¸­ ' + r.super : 'æœªä¸­ (é–‹ ' + r.super + ')'}
                        </div>
                    </div>`;
                }
            }
            box.innerHTML = html;
        }

        // --- åŒæ­¥èˆ‡è¨ˆæ™‚é‚è¼¯ ---
        function syncFromPeriod() {
            let p = parseInt(document.getElementById('start-p').value);
            if (isNaN(p) || p < BASE_PERIOD) return;
            let offset = p - BASE_PERIOD;
            let d = new Date(BASE_DATE); d.setDate(d.getDate() + Math.floor(offset / 203));
            document.getElementById('start-d').value = d.toISOString().split('T')[0];
            let mTotal = 7 * 60 + 5 + ((offset % 203) * 5);
            document.getElementById('start-t').value = `${String(Math.floor(mTotal/60)).padStart(2,'0')}:${String(mTotal%60).padStart(2,'0')}`;
        }

        function syncFromDateTime() {
            let d = new Date(document.getElementById('start-d').value);
            let t = document.getElementById('start-t').value.split(':');
            let diffDays = Math.floor((d - BASE_DATE) / 86400000);
            let idx = (parseInt(t[0])*60 + parseInt(t[1]) - 425) / 5;
            document.getElementById('start-p').value = BASE_PERIOD + (diffDays * 203) + idx;
        }

        function timer() {
            let n = new Date(); let m = n.getMinutes(), s = n.getSeconds();
            let remM = 4 - (m % 5), remS = 59 - s;
            document.getElementById('timer').innerText = `${String(remM).padStart(2,'0')}:${String(remS).padStart(2,'0')}`;
        }

        function show(id) { ['bet','hist','stats'].forEach(x => { document.getElementById(`sec-${x}`).classList.toggle('hidden', x !== id); document.getElementById(`t-${x}`).classList.toggle('active', x === id); }); }
        window.onload = init;
    </script>
</body>
</html>


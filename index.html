<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Bingo Bingo å°Šæ¦®çµ‚ç«¯</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background: #020617; color: #F8FAFC; font-family: 'PingFang TC', sans-serif; }
        .tc-gold { color: #FACC15; }
        .bg-gold { background: linear-gradient(135deg, #FACC15 0%, #EAB308 100%); }
        .card { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.05); }
        .num-btn.selected { background: #EF4444; border-color: #FACC15; box-shadow: 0 0 15px rgba(239, 68, 68, 0.4); transform: translateY(-2px); }
        .ball { aspect-ratio: 1; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.75rem; font-weight: 900; background: #0F172A; color: #FACC15; border: 1px solid #334155; }
        .nav-active { color: #FACC15; border-bottom: 3px solid #FACC15; }
    </style>
</head>
<body class="pb-10">

    <nav class="sticky top-0 z-50 bg-[#020617]/90 backdrop-blur border-b border-white/5 shadow-2xl">
        <div class="flex justify-around p-3 text-xs font-black tracking-tighter text-gray-400">
            <button onclick="show('bet')" id="t-bet" class="nav-active pb-1">æŠ•æ³¨å°ç</button>
            <button onclick="show('hist')" id="t-hist" class="pb-1">é–‹çç´€éŒ„</button>
            <button onclick="show('stats')" id="t-stats" class="pb-1">å†·ç†±éºæ¼</button>
        </div>
        <div class="bg-gradient-to-r from-red-700 to-red-600 px-4 py-1.5 flex justify-between items-center text-white">
            <span class="text-[10px] font-bold">NEXT DRAW IN</span>
            <span id="timer" class="text-2xl font-black font-mono">00:00</span>
        </div>
    </nav>

    <div class="max-w-md mx-auto p-4 space-y-5">
        
        <section id="sec-bet" class="space-y-4">
            <div class="card p-5 rounded-3xl space-y-6 shadow-xl">
                <div class="flex justify-between items-center">
                    <h2 class="text-xl font-black italic">BETTING HUB</h2>
                    <div id="bonus-tag" class="hidden bg-gold text-black text-[10px] px-2 py-0.5 rounded-full font-black animate-bounce">æ˜¥ç¯€åŠ ç¢¼ä¸­</div>
                </div>

                <div class="space-y-3 bg-black/30 p-4 rounded-2xl border border-white/5">
                    <div class="flex justify-between text-[10px] font-bold text-gray-500">
                        <span>AUTOMATIC DETECTION</span>
                        <span id="detect-time" class="text-blue-400">åµæ¸¬æ™‚é–“: --:--</span>
                    </div>
                    <div class="grid grid-cols-2 gap-3">
                        <input type="text" id="start-p" oninput="autoDetect(this.value)" class="bg-white/5 border border-white/10 rounded-xl p-3 text-lg font-black text-center text-yellow-400" placeholder="è¼¸å…¥æœŸæ•¸">
                        <div class="flex flex-col justify-center">
                            <button onclick="setNextDraw()" class="text-[10px] bg-white/10 py-2 rounded-lg font-bold hover:bg-white/20 transition">é è¨­ä¸‹ä¸€æœŸ</button>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-8 gap-1.5" id="num-grid"></div>

                <div class="grid grid-cols-3 gap-2">
                    <select id="stars" class="bg-white/5 border border-white/10 rounded-xl p-3 text-xs font-bold text-center"><option value="3" selected>3æ˜Ÿ</option><option value="4">4æ˜Ÿ</option><option value="5">5æ˜Ÿ</option><option value="6">6æ˜Ÿ</option><option value="10">10æ˜Ÿ</option></select>
                    <input type="number" id="mult" value="4" class="bg-white/5 border border-white/10 rounded-xl p-3 text-xs text-center font-bold" placeholder="å€æ•¸">
                    <input type="number" id="cons" value="10" class="bg-white/5 border border-white/10 rounded-xl p-3 text-xs text-center font-bold" placeholder="æœŸæ•¸">
                </div>

                <button onclick="runCheck()" class="w-full py-5 rounded-2xl bg-gold text-black font-black text-xl shadow-lg active:scale-95 transition">ğŸ¯ ç«‹å³å°ç</button>
            </div>
            <div id="res-box" class="hidden card rounded-2xl p-5 border-l-8 border-yellow-500"></div>
        </section>

        <section id="sec-hist" class="hidden space-y-4">
            <h3 class="text-[10px] font-black text-gray-500 tracking-widest text-center">--- LATEST RESULTS ---</h3>
            <div id="history-list" class="space-y-4"></div>
        </section>

        <section id="sec-stats" class="hidden space-y-4">
            <div class="card p-5 rounded-2xl"><h3 class="font-bold text-orange-400 mb-4 text-center">âŒ› è™Ÿç¢¼éºæ¼æ’è¡Œæ¦œ</h3><div id="gap-list" class="grid grid-cols-5 gap-2"></div></div>
        </section>
    </div>

    <script>
        const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vR7ZS9Nt-Y0kMHr_6lNy5FcMeYRn1_MVkmN_E3SuFDSxm7QkVT76NmeLkCWJNrR24U8XVtdTtn8IQc3/pub?gid=1857522434&single=true&output=csv";
        const ANCHOR_P = 115011765;
        const BONUS_RANGE = [115011572, 115012586]; // 115å¹´æ˜¥ç¯€åŠ ç¢¼
        
        let db = []; let sel = [];

        function init() {
            const g = document.getElementById('num-grid');
            for(let i=1; i<=80; i++) {
                let b = document.createElement('button');
                b.innerText = String(i).padStart(2,'0'); b.className = "num-btn bg-white/5 text-gray-400";
                b.onclick = () => {
                    const lim = parseInt(document.getElementById('stars').value);
                    if(sel.includes(i)) { sel = sel.filter(x=>x!==i); b.classList.remove('selected'); }
                    else if(sel.length < lim) { sel.push(i); b.classList.add('selected'); }
                }; g.appendChild(b);
            }
            refresh(); setInterval(timer, 1000);
        }

        // ğŸŒŸ æ™ºæ…§è‡ªå‹•åµæ¸¬åŠŸèƒ½
        function autoDetect(val) {
            if(val.length >= 9) {
                let p = parseInt(val);
                let diff = (p - ANCHOR_P) * 5;
                let d = new Date(2026, 1, 27, 23, 10); // æ ¡æº–åŸºæº–
                d.setMinutes(d.getMinutes() + diff);
                let timeStr = ("0"+d.getHours()).slice(-2) + ":" + ("0"+d.getMinutes()).slice(-2);
                let dateStr = (d.getMonth()+1) + "/" + d.getDate();
                document.getElementById('detect-time').innerText = `åµæ¸¬: ${dateStr} ${timeStr}`;
            }
        }

        // ğŸŒŸ é è¨­ä¸‹ä¸€æœŸé–‹çæœŸæ•¸
        function setNextDraw() {
            let now = new Date();
            let anchorDate = new Date(2026, 1, 27, 23, 10);
            let diffMs = now - anchorDate;
            let diffPeriods = Math.ceil(diffMs / (5 * 60 * 1000));
            let nextP = ANCHOR_P + diffPeriods;
            document.getElementById('start-p').value = nextP;
            autoDetect(String(nextP));
        }

        async function refresh() {
            try {
                const r = await fetch(CSV_URL + "&t=" + Date.now());
                const rows = (await r.text()).split('\n').filter(l=>l.trim());
                db = rows.slice(1).map(l => {
                    let p = l.split(/,(.+)/); let r2 = p[1].split(/,(.+)/); let r3 = r2[1].split(/,(.+)/);
                    return { id: p[0].trim(), time: r2[0].trim(), nums: r3[0].replace(/"/g,'').split(',').map(n=>parseInt(n)), bonus: parseInt(p[0]) >= BONUS_RANGE[0] && parseInt(p[0]) <= BONUS_RANGE[1] };
                });
                render();
                if(!document.getElementById('start-p').value) setNextDraw();
                document.getElementById('bonus-tag').classList.toggle('hidden', !db[0]?.bonus);
            } catch (e) {}
        }

        function render() {
            let h = '';
            db.slice(0, 10).forEach(d => {
                let balls = d.nums.map(n => `<div class="ball">${String(n).padStart(2,'0')}</div>`).join('');
                h += `<div class="card p-3 rounded-2xl border border-white/5">
                    <div class="flex justify-between text-[10px] mb-2 font-black text-gray-500">
                        <span>æœŸæ•¸ ${d.id} | ğŸ•’ ${d.time}</span>
                        ${d.bonus ? '<span class="bg-gold text-black px-1 rounded">åŠ ç¢¼æœŸ</span>' : ''}
                    </div>
                    <div class="grid grid-cols-10 gap-1">${balls}</div>
                </div>`;
            });
            document.getElementById('history-list').innerHTML = h;
            
            let gaps = {}; for(let i=1; i<=80; i++) gaps[i] = -1;
            db.forEach((d, idx) => d.nums.forEach(n => { if(gaps[n]===-1) gaps[n]=idx; }));
            let sorted = Object.keys(gaps).map(n=>({n,v:gaps[n]})).sort((a,b)=>b.v - a.v).slice(0,10);
            document.getElementById('gap-list').innerHTML = sorted.map(x=>`<div class="bg-white/5 p-2 rounded-xl"><div class="text-[10px] text-gray-500">${String(x.n).padStart(2,'0')}</div><div class="text-xs font-black text-orange-400">${x.v}æœŸ</div></div>`).join('');
        }

        function runCheck() {
            const star = parseInt(document.getElementById('stars').value);
            const mult = parseInt(document.getElementById('mult').value);
            const count = parseInt(document.getElementById('cons').value);
            const startP = parseInt(document.getElementById('start-p').value);
            if(sel.length !== star) return alert(`è«‹é¸æ»¿ ${star} å€‹è™Ÿç¢¼`);
            
            // å®˜æ–¹åŠ ç¢¼çé‡‘é‚è¼¯
            const PRIZES = { 1:{1:50}, 2:{2:75}, 3:{3:500,2:50}, 4:{4:1000,3:100,2:25}, 5:{5:7500,4:500,3:50}, 6:{6:25000,5:1000,4:200,3:25}, 10:{10:5000000,9:250000,8:25000,7:2500,6:250,5:25,0:25} };
            const BONUS = { 1:{1:75}, 2:{2:150}, 3:{3:1000,2:50}, 4:{4:2000,3:150,2:25}, 5:{5:10000,4:600,3:50}, 6:{6:50000,5:1200,4:200,3:25}, 10:{10:5000000,9:250000,8:25000,7:2500,6:250,5:25,0:25} };

            let totalWin = 0; let log = '';
            for(let i=0; i<count; i++) {
                let id = String(startP + i); let d = db.find(x => x.id === id);
                if(d) {
                    let m = sel.filter(n => d.nums.includes(n)).length;
                    let table = d.bonus ? BONUS[star] : PRIZES[star];
                    let win = (table[m] || (star === 10 && m === 0 ? 25 : 0)) * mult;
                    totalWin += win;
                    log += `<div class="flex justify-between p-2 border-b border-white/5 ${win > 0 ? 'text-yellow-400 font-bold' : 'text-gray-500'}"><span>${id}æœŸ (ä¸­${m})</span><span>$${win}</span></div>`;
                }
            }
            const res = document.getElementById('res-box'); res.classList.remove('hidden');
            res.innerHTML = `<h4 class="font-black text-xl flex justify-between">ç¸½çé‡‘ <span class="text-yellow-400">$${totalWin}</span></h4><div class="mt-3 space-y-1">${log}</div>`;
        }

        function timer() {
            let n = new Date(); let m = 4 - (n.getMinutes() % 5); let s = 59 - n.getSeconds();
            document.getElementById('timer').innerText = `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
        }

        function show(id) {
            ['bet','hist','stats'].forEach(x => {
                document.getElementById(`sec-${x}`).classList.toggle('hidden', x !== id);
                document.getElementById(`t-${x}`).classList.toggle('nav-active', x === id);
            });
        }
        window.onload = init;
    </script>
</body>
</html>


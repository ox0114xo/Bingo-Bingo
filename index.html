<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Bingo Bingo å°Šæ¦®ç™¼è²¡çµ‚ç«¯</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', 'Noto Sans TC', sans-serif; background-color: #050A15; color: #E0E0E0; }
        .gold-gradient { background: linear-gradient(135deg, #F1C40F 0%, #D4AF37 100%); }
        .card-dark { background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .num-btn { aspect-ratio: 1; transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .num-btn.selected { background-color: #E63946; color: white; border-color: #F1C40F; box-shadow: 0 0 15px rgba(230, 57, 70, 0.5); transform: scale(1.1); }
        .nav-tab.active { color: #F1C40F; border-bottom: 3px solid #F1C40F; }
        .win-grid { display: grid; grid-template-columns: repeat(10, 1fr); gap: 4px; }
        .win-ball { aspect-ratio: 1; display: flex; align-items: center; justify-content: center; border-radius: 50%; background: #252A34; font-weight: 900; font-size: 0.75rem; color: #F1C40F; border: 1px solid #3F4451; }
        ::-webkit-scrollbar { width: 0px; }
    </style>
</head>
<body>

    <nav class="sticky top-0 z-50 bg-[#050A15]/90 backdrop-blur-md border-b border-white/10">
        <div class="flex justify-around p-3 font-bold text-sm text-gray-400">
            <button onclick="showTab('bet')" id="tab-bet" class="nav-tab active pb-2">ğŸ¯ æ™ºèƒ½å°ç</button>
            <button onclick="showTab('trend')" id="tab-trend" class="nav-tab pb-2">ğŸ“ˆ æ•¸æ“šè¶¨å‹¢</button>
            <button onclick="showTab('memo')" id="tab-memo" class="nav-tab pb-2">ğŸ“’ ç™¼è²¡ç°¿</button>
        </div>
        <div class="bg-red-600 p-1 flex justify-center items-center gap-3">
            <span class="text-[10px] text-white font-black animate-pulse">LIVE NEXT DRAW</span>
            <span id="timer" class="text-white font-black text-xl tracking-tighter">00:00</span>
        </div>
    </nav>

    <div class="max-w-lg mx-auto p-4 space-y-6">

        <section id="sec-bet" class="space-y-4">
            <div class="card-dark rounded-2xl p-5 space-y-5">
                <div class="flex justify-between items-center">
                    <h2 class="text-xl font-black text-white">æŠ•æ³¨è¨­å®š</h2>
                    <div id="bonus-tag" class="hidden gold-gradient text-black px-2 py-0.5 rounded-full text-[10px] font-black">ğŸ’° çé‡‘åŠ ç¢¼ä¸­</div>
                </div>

                <div class="grid grid-cols-3 gap-2 p-1 bg-white/5 rounded-xl">
                    <button onclick="setMode('star')" id="m-star" class="py-2 rounded-lg text-sm font-bold bg-white/10 text-white">æ˜Ÿè™Ÿ</button>
                    <button onclick="setMode('bs')" id="m-bs" class="py-2 rounded-lg text-sm font-bold text-gray-500">å¤§å°</button>
                    <button onclick="setMode('oe')" id="m-oe" class="py-2 rounded-lg text-sm font-bold text-gray-500">å–®é›™</button>
                </div>

                <div class="grid grid-cols-4 gap-2">
                    <select id="star-select" class="bg-white/5 border border-white/10 rounded-lg p-2 text-xs font-bold text-yellow-400">
                        <option value="1">1æ˜Ÿ</option><option value="2">2æ˜Ÿ</option><option value="3" selected>3æ˜Ÿ</option>
                        <option value="4">4æ˜Ÿ</option><option value="5">5æ˜Ÿ</option><option value="6">6æ˜Ÿ</option>
                        <option value="10">10æ˜Ÿ</option>
                    </select>
                    <input type="number" id="mult" value="4" class="bg-white/5 border border-white/10 rounded-lg p-2 text-xs text-center font-bold" placeholder="å€æ•¸">
                    <input type="number" id="counts" value="10" class="bg-white/5 border border-white/10 rounded-lg p-2 text-xs text-center font-bold" placeholder="æœŸæ•¸">
                    <input type="text" id="start-p" class="bg-white/5 border border-white/10 rounded-lg p-2 text-xs text-center font-bold text-blue-400" placeholder="èµ·å§‹æœŸ">
                </div>

                <div id="picker-star">
                    <div class="text-[10px] text-gray-500 font-bold mb-2 flex justify-between">
                        <span>PICK NUMBERS (1-80)</span>
                        <span id="pick-info" class="text-yellow-500">å·²é¸ 0 å€‹</span>
                    </div>
                    <div class="grid grid-cols-8 gap-1.5" id="num-grid"></div>
                </div>

                <div id="picker-other" class="hidden grid grid-cols-2 gap-2">
                    <button onclick="selOpt('å¤§')" class="opt-btn py-4 border border-white/10 rounded-xl font-bold bg-white/5">å¤§</button>
                    <button onclick="selOpt('å°')" class="opt-btn py-4 border border-white/10 rounded-xl font-bold bg-white/5">å°</button>
                </div>

                <button onclick="runCheck()" class="gold-gradient text-black font-black py-4 rounded-xl w-full text-lg shadow-[0_0_20px_rgba(212,175,55,0.3)] active:scale-95 transition">ğŸ¯ é–‹å§‹å°ç</button>
            </div>

            <div id="res-box" class="hidden card-dark rounded-2xl p-4 border-l-4 border-yellow-500"></div>
        </section>

        <section id="sec-history" class="space-y-3">
            <h2 class="text-sm font-bold text-gray-500 tracking-widest">LATEST RESULTS</h2>
            <div id="history-list" class="space-y-3"></div>
        </section>

        <section id="sec-stats" class="space-y-4">
            <div class="card-dark rounded-2xl p-5">
                <h2 class="text-xl font-black mb-4 text-white">ğŸ”¥ å†·ç†±æ’è¡Œ (200æœŸ)</h2>
                <div id="rank-list" class="space-y-2 text-xs"></div>
            </div>
            <div class="card-dark rounded-2xl p-5">
                <h2 class="text-xl font-black mb-4 text-orange-400">â³ éºæ¼å€¼ (å¤šä¹…æ²’é–‹)</h2>
                <div id="gap-list" class="grid grid-cols-5 gap-2"></div>
            </div>
        </section>

    </div>

    <script>
        const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vR7ZS9Nt-Y0kMHr_6lNy5FcMeYRn1_MVkmN_E3SuFDSxm7QkVT76NmeLkCWJNrR24U8XVtdTtn8IQc3/pub?gid=1857522434&single=true&output=csv";
        let db = [];
        let selected = [];
        let curOpt = null;
        let mode = 'star';

        function init() {
            const grid = document.getElementById('num-grid');
            for(let i=1; i<=80; i++) {
                let b = document.createElement('button');
                b.innerText = String(i).padStart(2,'0');
                b.className = "num-btn border border-white/10 rounded-lg text-xs font-bold bg-white/5 text-gray-400";
                b.onclick = () => {
                    const limit = parseInt(document.getElementById('star-select').value);
                    if(selected.includes(i)) { selected = selected.filter(x=>x!==i); b.classList.remove('selected'); }
                    else if(selected.length < limit) { selected.push(i); b.classList.add('selected'); }
                    document.getElementById('pick-info').innerText = `å·²é¸ ${selected.length} / ${limit}`;
                };
                grid.appendChild(b);
            }
            refresh();
            setInterval(timer, 1000);
            setInterval(refresh, 30000);
        }

        async function refresh() {
            const res = await fetch(CSV_URL + "&t=" + Date.now());
            const lines = (await res.text()).split('\n').filter(l=>l.trim());
            db = lines.slice(1).map(l => {
                let p = l.split(/,(.+)/);
                let r = p[1].split(/,(.+)/);
                return { id: p[0].trim(), time: r[0].trim(), nums: r[1].replace(/"/g,'').split(',').map(n=>parseInt(n)) };
            });
            renderHistory();
            renderStats();
            if(db[0]) {
                document.getElementById('start-p').value = db[0].id;
                // æª¢æŸ¥æ˜¯å¦åŠ ç¢¼æœŸé–“ (ç°¡åŒ–ç‰ˆé‚è¼¯)
                const isBonus = (parseInt(db[0].id) >= 115006300); // å‡è¨­æœŸæ•¸å€æ®µ
                document.getElementById('bonus-tag').classList.toggle('hidden', !isBonus);
            }
        }

        function renderHistory() {
            let h = '';
            db.slice(0, 5).forEach(d => {
                let balls = d.nums.map(n => `<div class="win-ball">${String(n).padStart(2,'0')}</div>`).join('');
                h += `<div class="card-dark p-3 rounded-xl border border-white/5">
                    <div class="flex justify-between text-[10px] mb-2 font-bold text-gray-500">
                        <span>æœŸæ•¸ ${d.id}</span><span>ğŸ•’ ${d.time}</span>
                    </div>
                    <div class="win-grid">${balls}</div>
                </div>`;
            });
            document.getElementById('history-list').innerHTML = h;
        }

        function renderStats() {
            let c = {}; let gaps = {};
            for(let i=1; i<=80; i++) { c[i]=0; gaps[i]=-1; }
            db.forEach((d,idx) => {
                d.nums.forEach(n => {
                    c[n]++;
                    if(gaps[n] === -1) gaps[n] = idx;
                });
            });
            
            // å†·ç†±
            let sorted = Object.keys(c).map(n=>({n,v:c[n]})).sort((a,b)=>b.v-a.v);
            document.getElementById('rank-list').innerHTML = sorted.slice(0,5).map(x=>`
                <div class="flex items-center gap-2">
                    <span class="w-6 font-black text-yellow-500">${String(x.n).padStart(2,'0')}</span>
                    <div class="flex-1 h-1.5 bg-white/5 rounded-full overflow-hidden"><div class="h-full gold-gradient" style="width:${x.v/db.length*100*3}%"></div></div>
                    <span class="text-[10px] text-gray-500">${x.v}æ¬¡</span>
                </div>
            `).join('');

            // éºæ¼
            let gapSorted = Object.keys(gaps).map(n=>({n,v:gaps[n]})).sort((a,b)=>b.v-a.v);
            document.getElementById('gap-list').innerHTML = gapSorted.slice(0,10).map(x=>`
                <div class="text-center p-2 bg-white/5 rounded-lg border border-white/5">
                    <div class="text-[10px] text-gray-500">${String(x.n).padStart(2,'0')}</div>
                    <div class="text-xs font-black text-orange-500">${x.v}æœŸ</div>
                </div>
            `).join('');
        }

        function timer() {
            let n = new Date();
            let m = 4 - (n.getMinutes() % 5);
            let s = 59 - n.getSeconds();
            document.getElementById('timer').innerText = `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
        }

        function showTab(t) {
            ['bet','trend','memo'].forEach(x => {
                document.getElementById(`sec-${x === 'bet' ? 'bet' : x === 'trend' ? 'history' : 'stats'}`).classList.toggle('hidden', x !== t);
                document.getElementById(`tab-${x}`).classList.toggle('active', x === t);
            });
            if(t==='trend') document.getElementById('sec-stats').classList.remove('hidden');
        }

        function setMode(m) {
            mode = m;
            document.getElementById('picker-star').classList.toggle('hidden', m !== 'star');
            document.getElementById('picker-other').classList.toggle('hidden', m === 'star');
            document.querySelectorAll('#m-star, #m-bs, #m-oe').forEach(b => {
                b.classList.remove('bg-white/10','text-white'); b.classList.add('text-gray-500');
            });
            document.getElementById(`m-${m}`).classList.add('bg-white/10','text-white');
        }

        window.onload = init;
    </script>
</body>
</html>


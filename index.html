<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Winnerå°åŠ©æ‰‹ v4.0 - è³“æœçµ‚æ¥µç‰ˆ</title>
    <style>
        body { font-family: 'PingFang TC', sans-serif; background: #f8f9fa; margin: 0; padding: 0; }
        header { background: #c62828; color: white; padding: 15px; text-align: center; font-size: 20px; font-weight: bold; }
        
        .nav-tabs { display: flex; overflow-x: auto; background: white; padding: 10px; gap: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .tab-btn { white-space: nowrap; padding: 8px 16px; border: 1px solid #ddd; background: #fff; border-radius: 20px; cursor: pointer; }
        .tab-btn.active { background: #ef5350; color: white; border-color: #ef5350; }

        .container { max-width: 600px; margin: 15px auto; padding: 0 12px; }
        .card { background: white; border-radius: 12px; padding: 18px; margin-bottom: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
        
        /* è³“æœé€²éšæ§åˆ¶é¢æ¿ */
        .game-panel { background: #fff3e0; border-radius: 10px; padding: 12px; margin-bottom: 15px; display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .game-panel select, .game-panel input { width: 100%; padding: 8px; border-radius: 6px; border: 1px solid #ffb74d; font-size: 14px; }
        .game-panel label { font-size: 12px; color: #e65100; font-weight: bold; display: block; margin-bottom: 4px; }

        .check-area { display: flex; flex-direction: column; gap: 10px; }
        .main-input { padding: 12px; font-size: 18px; border: 2px solid #ef5350; border-radius: 8px; text-align: center; font-weight: bold; }
        .btn-run { padding: 12px; background: #2e7d32; color: white; border: none; border-radius: 8px; font-size: 18px; font-weight: bold; cursor: pointer; }

        /* çµæœå±•ç¤º */
        #res-box { margin-top: 15px; padding: 15px; border-radius: 10px; text-align: center; display: none; border: 2px dashed #bbb; }
        .status-win { background: #e8f5e9; color: #1b5e20; border-color: #4caf50 !important; }

        /* å½©çƒè¦–è¦º */
        .ball-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 6px; margin-top: 10px; }
        .ball { height: 36px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 15px; font-weight: bold; background: #fff9c4; border: 1px solid #fbc02d; }
        .ball.sp { background: #ffcdd2; border-color: #e53935; color: #b71c1c; position: relative; }
        .ball.sp::after { content: "â˜…"; position: absolute; top: -2px; right: 2px; font-size: 10px; }
        
        .side-info { display: flex; gap: 10px; margin-top: 8px; font-size: 13px; font-weight: bold; }
        .tag { padding: 2px 8px; border-radius: 4px; background: #eceff1; color: #455a64; }
    </style>
</head>
<body>

<header>Winnerå°åŠ©æ‰‹ v4.0 - è³“æœæ——è‰¦</header>

<div class="nav-tabs">
    <button class="tab-btn active" onclick="setGame('è³“æœè³“æœ')">è³“æœè³“æœ</button>
    <button class="tab-btn" onclick="setGame('å¤§æ¨‚é€')">å¤§æ¨‚é€</button>
    <button class="tab-btn" onclick="setGame('å¨åŠ›å½©')">å¨åŠ›å½©</button>
    <button class="tab-btn" onclick="setGame('ä»Šå½©539')">ä»Šå½©539</button>
</div>

<div class="container">
    <div class="card">
        <div id="bingo-controls">
            <div class="game-panel">
                <div>
                    <label>é¸æ“‡ç©æ³•</label>
                    <select id="sel-star">
                        <option value="10">10æ˜Ÿ</option><option value="5">5æ˜Ÿ</option>
                        <option value="3">3æ˜Ÿ</option><option value="1">1æ˜Ÿ</option>
                        <option value="big">çŒœå¤§å°</option><option value="odd">çŒœå–®é›™</option>
                    </select>
                </div>
                <div>
                    <label>å°çæœŸæ•¸</label>
                    <select id="sel-period"></select>
                </div>
            </div>
        </div>

        <div class="check-area">
            <input type="text" id="user-input" class="main-input" placeholder="è¼¸å…¥è™Ÿç¢¼ (ç©ºæ ¼éš”é–‹) æˆ–é¸å¤§å°">
            <button class="btn-run" onclick="calculate()">ç«‹å³å°çè¨ˆç®—çé‡‘</button>
        </div>
        
        <div id="res-box"></div>
    </div>

    <div id="history-list"></div>
</div>

<script>
const LOTTO_CONFIG = {
    'è³“æœè³“æœ': { file: 'è³“æœè³“æœ_2026.csv', balls: 'é–‹å‡ºè™Ÿç¢¼', super: 'è¶…ç´šçè™Ÿ', side: ['å¤§å°', 'å–®é›™'] },
    'å¤§æ¨‚é€': { file: 'å¤§æ¨‚é€_2026.csv', balls: ['çè™Ÿ1','çè™Ÿ2','çè™Ÿ3','çè™Ÿ4','çè™Ÿ5','çè™Ÿ6'], super: 'ç‰¹åˆ¥è™Ÿ' },
    'å¨åŠ›å½©': { file: 'å¨åŠ›å½©_2026.csv', balls: ['ç¬¬ä¸€å€1','ç¬¬ä¸€å€2','ç¬¬ä¸€å€3','ç¬¬ä¸€å€4','ç¬¬ä¸€å€5','ç¬¬ä¸€å€6'], super: 'ç¬¬äºŒå€' },
    'ä»Šå½©539': { file: 'ä»Šå½©539_2026.csv', balls: ['çè™Ÿ1','çè™Ÿ2','çè™Ÿ3','çè™Ÿ4','çè™Ÿ5'], super: null }
};

let currentData = [];
let gameMode = 'è³“æœè³“æœ';

async function setGame(name) {
    gameMode = name;
    document.querySelectorAll('.tab-btn').forEach(b => b.classList.toggle('active', b.innerText === name));
    document.getElementById('bingo-controls').style.display = (name === 'è³“æœè³“æœ') ? 'block' : 'none';
    await loadCSV();
}

async function loadCSV() {
    const container = document.getElementById('history-list');
    container.innerHTML = 'è¼‰å…¥ä¸­...';
    try {
        const resp = await fetch(`./lotto/${LOTTO_CONFIG[gameMode].file}`);
        const text = await resp.text();
        currentData = parseCSV(text);
        
        // å¡«å……æœŸæ•¸
        const pSel = document.getElementById('sel-period');
        pSel.innerHTML = currentData.slice(0, 30).map(d => `<option value="${d.æœŸæ•¸ || d.æœŸåˆ¥}">${d.æœŸæ•¸ || d.æœŸåˆ¥}</option>`).join('');
        
        renderUI();
    } catch (e) { container.innerHTML = 'è®€å–å¤±æ•—ï¼Œè«‹ç¢ºèªæª”æ¡ˆã€‚'; }
}

function parseCSV(text) {
    const lines = text.trim().split('\n');
    const headers = lines[0].split(',').map(h => h.trim());
    return lines.slice(1).map(l => {
        let vals = [], q = false, c = '';
        for (let char of l) {
            if (char === '"') q = !q;
            else if (char === ',' && !q) { vals.push(c.trim()); c = ''; }
            else c += char;
        }
        vals.push(c.trim());
        let o = {}; headers.forEach((h, i) => o[h] = vals[i]);
        return o;
    });
}

function renderUI() {
    const container = document.getElementById('history-list');
    container.innerHTML = '';
    currentData.slice(0, 5).forEach(row => {
        const card = document.createElement('div');
        card.className = 'card';
        
        let ballList = [];
        if (gameMode === 'è³“æœè³“æœ') {
            // ğŸ’¡ å¾¹åº•è§£æ±ºã€Œé»åœ¨ä¸€èµ·ã€ï¼šå°‡é–‹å‡ºè™Ÿç¢¼ä¾é€—è™Ÿæˆ–ç©ºæ ¼åˆ‡é–‹
            ballList = row['é–‹å‡ºè™Ÿç¢¼'].split(/[ ,]+/).filter(n => n.length > 0);
        } else {
            LOTTO_CONFIG[gameMode].balls.forEach(key => ballList.push(row[key]));
        }

        let ballHtml = ballList.map(n => `<div class="ball">${n.padStart(2,'0')}</div>`).join('');
        if (LOTTO_CONFIG[gameMode].super && row[LOTTO_CONFIG[gameMode].super]) {
            ballHtml += `<div class="ball sp">${row[LOTTO_CONFIG[gameMode].super].padStart(2,'0')}</div>`;
        }

        let sideHtml = '';
        if (gameMode === 'è³“æœè³“æœ') {
            sideHtml = `<div class="side-info">
                <span class="tag">å¤§å°: ${row['å¤§å°'] || 'ï¼'}</span>
                <span class="tag">å–®é›™: ${row['å–®é›™'] || 'ï¼'}</span>
            </div>`;
        }

        card.innerHTML = `<strong>ç¬¬ ${row.æœŸæ•¸ || row.æœŸåˆ¥} æœŸ</strong> <small>${row.æ—¥æœŸ || row.é–‹çæ—¥æœŸ}</small>
                          ${sideHtml}<div class="ball-grid">${ballHtml}</div>`;
        container.appendChild(card);
    });
}

function calculate() {
    const targetP = document.getElementById('sel-period').value;
    const draw = currentData.find(d => (d.æœŸæ•¸ || d.æœŸåˆ¥) === targetP);
    const resultBox = document.getElementById('res-box');
    
    if (!draw) return;

    let winningNums = [];
    if (gameMode === 'è³“æœè³“æœ') {
        winningNums = draw['é–‹å‡ºè™Ÿç¢¼'].split(/[ ,]+/).map(n => n.trim().padStart(2, '0'));
        const sp = draw['è¶…ç´šçè™Ÿ'].padStart(2, '0');
        winningNums.push(sp); // åˆä½µæˆ 20 é¡†çƒ
    }

    const userInput = document.getElementById('user-input').value.trim();
    const userNums = userInput.split(/[ ,]+/).map(n => n.padStart(2, '0'));
    
    const matched = userNums.filter(n => winningNums.includes(n));
    const star = document.getElementById('sel-star').value;

    resultBox.style.display = 'block';
    resultBox.className = matched.length > 0 ? 'card status-win' : 'card';
    
    let msg = `<strong>å°çæœŸæ•¸ï¼š${targetP}</strong><br>`;
    
    if (star === 'big' || star === 'odd') {
        const actual = (star === 'big') ? draw['å¤§å°'] : draw['å–®é›™'];
        const win = userInput.includes(actual);
        msg += `ç³»çµ±åˆ¤å®šç‚ºï¼š<span style="font-size:20px">${actual}</span><br>`;
        msg += win ? 'ğŸ”¥ æ­å–œä¸­çï¼' : 'âŒ æ²’ä¸­ï¼Œå†æ¥å†å²';
    } else {
        msg += `å°ä¸­é¡†æ•¸ï¼š<span style="font-size:24px">${matched.length}</span> é¡†<br>`;
        if (matched.includes(draw['è¶…ç´šçè™Ÿ'].padStart(2,'0'))) msg += 'ğŸŒŸ è¶…ç´šçè™Ÿå‘½ä¸­ï¼çé‡‘åŠ å€ï¼';
    }
    
    resultBox.innerHTML = msg;
}

window.onload = () => setGame('è³“æœè³“æœ');
</script>
</body>
</html>


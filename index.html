<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bingo Bingo æ™ºèƒ½çµ‚ç«¯</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .tc-red { color: #E63946; }
        .tc-bg-red { background-color: #E63946; }
        .tc-bg-dark { background-color: #0A1931; }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 pb-20">

    <div class="tc-bg-dark text-white p-4 shadow-md sticky top-0 z-50">
        <h1 class="text-2xl font-bold text-center mb-2">ğŸ° Bingo Bingo æ™ºèƒ½çµ‚ç«¯</h1>
        <div class="flex justify-center items-center gap-4 text-xl">
            <span>â³ ä¸‹æœŸé–‹çå€’æ•¸ï¼š</span>
            <span id="timer" class="text-yellow-400 font-mono font-bold text-2xl">--:--</span>
        </div>
    </div>

    <div class="max-w-4xl mx-auto p-4 space-y-6 mt-4">
        <div id="status-box" class="p-3 rounded-lg bg-gray-200 text-center font-bold shadow animate-pulse">
            ğŸ”„ æ­£åœ¨è®€å– Google è©¦ç®—è¡¨è³‡æ–™...
        </div>

        <div class="bg-white p-4 rounded-xl shadow border-t-4 border-red-500">
            <h2 class="text-xl font-bold mb-4 tc-red border-b pb-2">ğŸ“Š æœ€æ–°é–‹çè™Ÿç¢¼</h2>
            <div id="draws-container" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
        </div>

        <div class="bg-white p-4 rounded-xl shadow border-t-4 border-blue-900">
            <h2 class="text-xl font-bold mb-4 text-blue-900 border-b pb-2">ğŸ“ æŠ•æ³¨èˆ‡å°çè©¦ç®—</h2>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4">
                <div><label class="block text-sm font-bold mb-1">ç©æ³•</label><select id="star-select" class="w-full border p-2 rounded"><option value="1">1æ˜Ÿ</option><option value="2">2æ˜Ÿ</option><option value="3" selected>3æ˜Ÿ</option><option value="4">4æ˜Ÿ</option><option value="5">5æ˜Ÿ</option><option value="6">6æ˜Ÿ</option></select></div>
                <div><label class="block text-sm font-bold mb-1">å€æ•¸</label><input type="number" id="multiplier" value="4" class="w-full border p-2 rounded"></div>
                <div><label class="block text-sm font-bold mb-1">é€£çºŒæœŸæ•¸</label><input type="number" id="draw-counts" value="10" class="w-full border p-2 rounded"></div>
                <div><label class="block text-sm font-bold mb-1">èµ·å§‹æœŸæ•¸</label><input type="text" id="start-draw" class="w-full border p-2 rounded"></div>
            </div>
            <div class="mb-4">
                <label class="block text-sm font-bold mb-1">è¼¸å…¥è™Ÿç¢¼ (ç”¨é€—è™Ÿéš”é–‹)</label>
                <input type="text" id="user-numbers" placeholder="ä¾‹: 5, 12, 66" class="w-full border-2 p-3 rounded-lg border-blue-900 font-bold text-lg">
            </div>
            <button onclick="calculatePrize()" class="tc-bg-red text-white font-bold py-3 px-4 rounded-lg w-full text-lg shadow-lg">ğŸ¯ ç«‹å³å°ç</button>
            <div id="result-box" class="mt-6 p-4 rounded-lg hidden border"></div>
        </div>
    </div>

    <script>
        // ğŸŒŸ å¯¶è²æä¾›çš„æ­£ç¢º CSV ç¶²å€
        const GOOGLE_CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vR7ZS9Nt-Y0kMHr_6lNy5FcMeYRn1_MVkmN_E3SuFDSxm7QkVT76NmeLkCWJNrR24U8XVtdTtn8IQc3/pub?gid=1857522434&single=true&output=csv";

        function updateTime() {
            let now = new Date();
            let nextMin = Math.ceil((now.getMinutes() + 1) / 5) * 5;
            let remainMin = nextMin - now.getMinutes() - 1;
            let remainSec = 60 - now.getSeconds();
            if(remainSec === 60) { remainMin += 1; remainSec = 0; }
            document.getElementById('timer').innerText = String(remainMin).padStart(2, '0') + ":" + String(remainSec).padStart(2, '0');
        }
        setInterval(updateTime, 1000); updateTime();

        let globalBingoData = [];
        const PRIZE_TABLE = { 1: {1: 50}, 2: {2: 75}, 3: {3: 500, 2: 50}, 4: {4: 1000, 3: 100, 2: 25}, 5: {5: 7500, 4: 500, 3: 50}, 6: {6: 25000, 5: 1000, 4: 200, 3: 25} };

        async function fetchGoogleSheetData() {
            try {
                const response = await fetch(GOOGLE_CSV_URL + "&t=" + new Date().getTime());
                const csvText = await response.text();
                const lines = csvText.split(/\r?\n/).filter(line => line.trim() !== "");
                let tempData = [];
                for(let i = 1; i < lines.length; i++) {
                    let parts = lines[i].split(/,(.+)/);
                    let draw_id = parts[0].trim();
                    let rest = parts[1].split(/,(.+)/);
                    let time = rest[0].trim();
                    let numbers = rest[1].replace(/"/g, '').split(',').map(n => parseInt(n.trim())).filter(n => !isNaN(n));
                    if(numbers.length === 20) tempData.push({ draw_id, time, numbers });
                }
                if(tempData.length > 0) {
                    globalBingoData = tempData;
                    document.getElementById('status-box').className = "p-3 rounded-lg bg-green-100 text-green-800 text-center font-bold shadow";
                    document.getElementById('status-box').innerHTML = `ğŸŸ¢ æˆåŠŸè®€å– ${globalBingoData.length} æœŸè³‡æ–™`;
                    document.getElementById('start-draw').value = globalBingoData[0].draw_id;
                    let html = '';
                    globalBingoData.slice(0, 6).forEach(draw => {
                        html += `<div class="p-4 border rounded-xl bg-white shadow-sm"><div class="font-bold tc-red text-lg">ç¬¬ ${draw.draw_id} æœŸ <span class="text-sm text-gray-500 ml-2">ğŸ•’ ${draw.time}</span></div><div class="text-lg font-mono tracking-widest bg-gray-50 p-2 rounded">${draw.numbers.map(n => String(n).padStart(2, '0')).join(', ')}</div></div>`;
                    });
                    document.getElementById('draws-container').innerHTML = html;
                }
            } catch (error) { document.getElementById('status-box').innerHTML = `ğŸ”´ è®€å–å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç™¼ä½ˆè¨­å®šã€‚`; }
        }

        function calculatePrize() {
            const star = parseInt(document.getElementById('star-select').value);
            const mult = parseInt(document.getElementById('multiplier').value);
            const counts = parseInt(document.getElementById('draw-counts').value);
            const startId = parseInt(document.getElementById('start-draw').value);
            const userNums = document.getElementById('user-numbers').value.split(/[,ï¼Œã€]/).map(n => parseInt(n)).filter(n => !isNaN(n));
            const resBox = document.getElementById('result-box');
            resBox.classList.remove('hidden');
            if(userNums.length !== star) { resBox.innerHTML = "âš ï¸ è™Ÿç¢¼æ•¸é‡èˆ‡æ˜Ÿæ•¸ä¸ç¬¦"; return; }
            let totalPrize = 0; let log = '';
            for(let i=0; i<counts; i++) {
                let id = String(startId + i);
                let draw = globalBingoData.find(d => d.draw_id === id);
                if(draw) {
                    let matched = userNums.filter(n => draw.numbers.includes(n));
                    let prize = (PRIZE_TABLE[star][matched.length] || 0) * mult;
                    totalPrize += prize;
                    log += `<div class="border-b p-2 flex justify-between"><span>ç¬¬ ${id} æœŸï¼šä¸­ ${matched.length} é¡†</span> <b>$${prize}</b></div>`;
                }
            }
            resBox.className = "mt-6 p-4 rounded-xl bg-blue-50 border border-blue-200";
            resBox.innerHTML = `<h3 class="font-bold text-xl mb-2">ç¸½çé‡‘ï¼š<span class="tc-red">$${totalPrize}</span></h3><div class="max-h-60 overflow-y-auto bg-white p-2 rounded text-sm">${log}</div>`;
        }
        fetchGoogleSheetData();
    </script>
</body>
</html>

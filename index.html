<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Bingo Bingo æ•¸æ“šçµ‚ç«¯</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background: #0F172A; color: #F1F5F9; font-family: sans-serif; overflow-x: hidden; }
        .bg-gold { background: linear-gradient(135deg, #FACC15 0%, #EAB308 100%); color: #000; }
        .card { background: rgba(30, 41, 59, 0.8); border: 1px solid rgba(255,255,255,0.05); border-radius: 20px; }
        .ball-grid { display: grid; grid-template-columns: repeat(10, 1fr); gap: 4px; }
        .ball { aspect-ratio: 1; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.7rem; font-weight: 900; background: #334155; color: #FACC15; border: 1px solid #475569; }
        .ball.super { background: #EF4444; color: white; border-color: #DC2626; box-shadow: 0 0 8px rgba(239, 68, 68, 0.6); }
        .nav-item.active { color: #FACC15; border-bottom: 3px solid #FACC15; font-weight: 900; }
        input, select { background: #1E293B !important; color: white !important; border: 1px solid #334155 !important; border-radius: 8px !important; }
        .num-btn.selected { background: #EF4444 !important; border-color: #FACC15 !important; transform: scale(1.1); box-shadow: 0 0 10px rgba(239, 68, 68, 0.5); }
        .mode-btn { background: #334155; color: white; border-radius: 8px; padding: 15px; font-weight: bold; text-align: center; cursor: pointer; border: 2px solid transparent; }
        .mode-btn.selected { background: #FACC15; color: black; border-color: white; }
    </style>
</head>
<body class="pb-10">

    <nav class="sticky top-0 z-50 bg-[#0F172A]/95 backdrop-blur shadow-2xl">
        <div class="flex justify-around p-3 text-xs font-bold text-gray-500">
            <button onclick="show('bet')" id="t-bet" class="nav-item active pb-1">æŠ•æ³¨å°ç</button>
            <button onclick="show('hist')" id="t-hist" class="nav-item pb-1">é–‹çç´€éŒ„</button>
            <button onclick="show('stats')" id="t-stats" class="nav-item pb-1">æ•¸æ“šå¤§ç›¤</button>
        </div>
        <div id="countdown-bar" class="bg-red-600 px-4 py-1.5 flex justify-between items-center text-white">
            <span class="text-[10px] font-black italic" id="timer-label">BINGO COUNTDOWN</span>
            <span id="timer" class="text-2xl font-black font-mono">--:--</span>
        </div>
    </nav>

    <div class="max-w-md mx-auto p-4 space-y-6">
        <section id="sec-bet" class="space-y-4">
            <div class="card p-5 space-y-6">
                <div class="grid grid-cols-2 gap-3 p-4 bg-black/40 rounded-2xl border border-white/5">
                    <div>
                        <label class="text-[10px] text-gray-500 block mb-1 font-bold">é–‹çæ—¥æœŸ</label>
                        <input type="date" id="start-d" onchange="syncFromDateTime()" class="w-full p-2 text-center font-black text-sm">
                    </div>
                    <div>
                        <label class="text-[10px] text-gray-500 block mb-1 font-bold">æ™‚é–“é¸æ“‡</label>
                        <select id="start-t" onchange="syncFromDateTime()" class="w-full p-2 text-center font-black text-sm"></select>
                    </div>
                    <div class="col-span-2">
                        <label class="text-[10px] text-gray-500 block mb-1 font-bold">é–‹çæœŸæ•¸</label>
                        <input type="text" id="start-p" oninput="syncFromPeriod()" class="w-full p-2 text-center text-yellow-400 font-black text-lg tracking-widest">
                    </div>
                </div>

                <div class="grid grid-cols-3 gap-2 text-center">
                    <div>
                        <label class="text-[10px] font-bold text-gray-400 mb-1 block">ç©æ³•é¸æ“‡</label>
                        <select id="playMode" class="w-full p-3 text-xs font-bold text-yellow-500" onchange="changePlayMode()">
                            <option value="1">1æ˜Ÿ</option><option value="2">2æ˜Ÿ</option><option value="3" selected>3æ˜Ÿ</option>
                            <option value="4">4æ˜Ÿ</option><option value="5">5æ˜Ÿ</option><option value="6">6æ˜Ÿ</option>
                            <option value="7">7æ˜Ÿ</option><option value="8">8æ˜Ÿ</option><option value="9">9æ˜Ÿ</option><option value="10">10æ˜Ÿ</option>
                            <option value="super">è¶…ç´šçè™Ÿ</option><option value="bs">çŒœå¤§å°</option><option value="oe">çŒœå–®é›™</option>
                        </select>
                    </div>
                    <div>
                        <label class="text-[10px] font-bold text-gray-400 mb-1 block">å€æ•¸ (æ¯æ³¨ 25 å…ƒ)</label>
                        <input type="number" id="mult" value="4" min="1" class="w-full p-3 text-xs text-center font-bold">
                    </div>
                    <div>
                        <label class="text-[10px] font-bold text-gray-400 mb-1 block">é€£çºŒæœŸæ•¸</label>
                        <input type="number" id="cons" value="10" min="1" class="w-full p-3 text-xs text-center font-bold">
                    </div>
                </div>

                <div class="grid grid-cols-8 gap-1.5" id="num-grid"></div>

                <div class="grid grid-cols-2 gap-4 hidden" id="bs-oe-grid">
                    <div id="btn-opt1" class="mode-btn" onclick="selectBsOe(this)"></div>
                    <div id="btn-opt2" class="mode-btn" onclick="selectBsOe(this)"></div>
                </div>

                <button onclick="runCheck()" class="w-full py-4 rounded-xl bg-gold font-black text-lg shadow-lg active:scale-95 transition">ğŸ¯ ç«‹å³å°ç</button>
            </div>
            
            <div id="res-box" class="hidden card p-5 border-t-4 border-yellow-500"></div>
        </section>

        <section id="sec-hist" class="hidden space-y-4"><div id="history-list" class="space-y-4"></div></section>

        <section id="sec-stats" class="hidden space-y-4">
            <div class="card p-4">
                <table class="w-full text-left text-xs">
                    <thead><tr class="text-gray-500 border-b border-white/10"><th class="py-2">è™Ÿç¢¼</th><th onclick="renderStats('gap')">éºæ¼ â†•</th><th onclick="renderStats('hot')">æ¬¡æ•¸ â†•</th><th onclick="renderStats('streak')">é€£é–‹ â†•</th></tr></thead>
                    <tbody id="stats-list" class="divide-y divide-white/5"></tbody>
                </table>
            </div>
        </section>
    </div>

    <script>
        const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vR7ZS9Nt-Y0kMHr_6lNy5FcMeYRn1_MVkmN_E3SuFDSxm7QkVT76NmeLkCWJNrR24U8XVtdTtn8IQc3/pub?gid=1857522434&single=true&output=csv";
        const BASE_DATE = new Date(2026, 0, 1);
        const BASE_PERIOD = 115000001;
        let db = []; 
        let selNum = []; 
        let selStr = ""; 

        // çé‡‘è¡¨ (ä»¥å–®æ³¨ 25 å…ƒç‚ºåŸºæº–)
        const PAY_TABLE = {
            10: {10: 5000000, 9: 250000, 8: 25000, 7: 2500, 6: 250, 5: 25, 0: 25},
            9: {9: 1000000, 8: 100000, 7: 3000, 6: 500, 5: 100, 4: 25, 0: 25},
            8: {8: 500000, 7: 20000, 6: 1000, 5: 200, 4: 25, 0: 25},
            7: {7: 80000, 6: 3000, 5: 300, 4: 50, 3: 25},
            6: {6: 25000, 5: 1000, 4: 200, 3: 25},
            5: {5: 7500, 4: 500, 3: 50},
            4: {4: 1000, 3: 100, 2: 25},
            3: {3: 500, 2: 50},
            2: {2: 75, 1: 25},
            1: {1: 50}
        };

        // æ˜¥ç¯€åŠ ç¢¼çé‡‘è¡¨ (åƒ… 1-6 æ˜Ÿ)
        const BONUS_TABLE = {
            6: {6: 50000, 5: 1200},
            5: {5: 10000, 4: 600},
            4: {4: 2000, 3: 150},
            3: {3: 1000},
            2: {2: 150},
            1: {1: 75}
        };

        function init() {
            const st = document.getElementById('start-t');
            for(let h=7; h<=23; h++){
                for(let m=0; m<60; m+=5){
                    if(h===7 && m<5) continue; if(h===23 && m>55) continue;
                    let ts = `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}`;
                    st.add(new Option(ts, ts));
                }
            }
            
            const g = document.getElementById('num-grid');
            for(let i=1; i<=80; i++) {
                let b = document.createElement('button'); 
                b.innerText = String(i).padStart(2,'0'); 
                b.className = "aspect-square rounded-lg bg-[#1E293B] border border-[#334155] font-bold text-[10px] text-gray-400 transition-colors";
                b.onclick = () => {
                    let mode = document.getElementById('playMode').value;
                    let lim = mode === 'super' ? 1 : parseInt(mode);
                    if(selNum.includes(i)) { 
                        selNum = selNum.filter(x => x !== i); 
                        b.classList.remove('num-btn', 'selected'); 
                    } else if(selNum.length < lim) { 
                        selNum.push(i); 
                        b.classList.add('num-btn', 'selected'); 
                    }
                }; 
                g.appendChild(b);
            }

            refresh(); 
            setInterval(timer, 1000);
        }

        async function refresh() {
            try {
                const r = await fetch(CSV_URL + "&t=" + Date.now());
                const csv = await r.text();
                db = csv.split('\n').slice(1).filter(l => l.trim()).map(l => {
                    const p = l.match(/(".*?"|[^",\s]+)(?=\s*,|\s*$)/g);
                    if(!p || p.length < 5) return null;
                    return { 
                        date: p[0], id: p[1], time: p[2], 
                        nums: p[3].replace(/"/g,'').split(',').map(n => parseInt(n.trim())), 
                        bonus: p[4].includes("åŠ ç¢¼"),
                        superNum: p.length >= 6 ? parseInt(p[5].replace(/"/g,'').trim()) : null
                    };
                }).filter(x => x && x.nums.length === 20);
                
                renderHistory(); renderStats('gap');
                
                // é è¨­å¡«å…¥æœ€æ–°ä¸€æœŸè³‡è¨Š
                if(!document.getElementById('start-p').value && db.length > 0) {
                    document.getElementById('start-p').value = db[0].id;
                    syncFromPeriod();
                }
            } catch (e) {}
        }

        function changePlayMode() {
            selNum = []; selStr = "";
            document.querySelectorAll('#num-grid button').forEach(b => b.classList.remove('num-btn', 'selected'));
            document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('selected'));
            
            let mode = document.getElementById('playMode').value;
            if (['bs', 'oe'].includes(mode)) {
                document.getElementById('num-grid').style.display = 'none';
                document.getElementById('bs-oe-grid').style.display = 'grid';
                document.getElementById('btn-opt1').innerText = mode === 'bs' ? 'å¤§' : 'å–®';
                document.getElementById('btn-opt2').innerText = mode === 'bs' ? 'å°' : 'é›™';
            } else {
                document.getElementById('num-grid').style.display = 'grid';
                document.getElementById('bs-oe-grid').style.display = 'none';
            }
        }

        function selectBsOe(btn) {
            document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            selStr = btn.innerText;
        }

        function syncFromPeriod() {
            let p = parseInt(document.getElementById('start-p').value);
            if (isNaN(p) || p < BASE_PERIOD) return;
            let offset = p - BASE_PERIOD, days = Math.floor(offset / 203), idx = offset % 203;
            let d = new Date(BASE_DATE); d.setDate(d.getDate() + days);
            document.getElementById('start-d').value = d.toISOString().split('T')[0];
            let mT = 7 * 60 + 5 + (idx * 5);
            document.getElementById('start-t').value = `${String(Math.floor(mT/60)).padStart(2,'0')}:${String(mT%60).padStart(2,'0')}`;
        }

        function syncFromDateTime() {
            let dStr = document.getElementById('start-d').value, tStr = document.getElementById('start-t').value;
            if (!dStr || !tStr) return;
            let targetDate = new Date(dStr);
            let diffDays = Math.floor((targetDate - BASE_DATE) / (1000 * 60 * 60 * 24));
            let parts = tStr.split(':');
            let mT = parseInt(parts[0], 10) * 60 + parseInt(parts[1], 10);
            let idx = (mT - (7 * 60 + 5)) / 5;
            document.getElementById('start-p').value = (BASE_PERIOD + (diffDays * 203) + idx).toString();
        }

        function runCheck() {
            let startP = parseInt(document.getElementById('start-p').value);
            let cons = parseInt(document.getElementById('cons').value);
            let mult = parseInt(document.getElementById('mult').value);
            let mode = document.getElementById('playMode').value;

            if (isNaN(startP)) return alert("è«‹è¼¸å…¥æ­£ç¢ºçš„é–‹çæœŸæ•¸");
            if (['bs', 'oe'].includes(mode) && !selStr) return alert("è«‹é¸æ“‡ä¸€é …ç©æ³• (å¤§å°/å–®é›™)ï¼");
            if (!['bs', 'oe'].includes(mode)) {
                let lim = mode === 'super' ? 1 : parseInt(mode);
                if (selNum.length !== lim) return alert(`è«‹é¸æ“‡ ${lim} å€‹è™Ÿç¢¼ï¼`);
            }

            let box = document.getElementById('res-box'); box.classList.remove('hidden');
            let selText = ['bs', 'oe'].includes(mode) ? selStr : selNum.map(n => String(n).padStart(2,'0')).sort().join(', ');
            let title = mode === 'super' ? 'è¶…ç´šçè™Ÿ' : (mode === 'bs' ? 'çŒœå¤§å°' : (mode === 'oe' ? 'çŒœå–®é›™' : `${mode}æ˜Ÿ`));
            
            let html = `<div class="font-black text-yellow-500 mb-3 text-lg border-b border-white/10 pb-2">ğŸ¯ å°çå ±å‘Š (${title})</div>`;
            html += `<div class="text-xs text-gray-400 mb-4 flex justify-between"><span>æ‚¨çš„é¸è™Ÿï¼š<b class="text-white">${selText}</b></span><span>å€æ•¸: ${mult}</span></div>`;
            
            let foundCount = 0; let totalWin = 0; let totalCost = cons * mult * 25;

            for (let i = 0; i < cons; i++) {
                let targetId = (startP + i).toString();
                let record = db.find(x => x.id === targetId);

                if (record) {
                    foundCount++;
                    let isBonusPeriod = parseInt(targetId) >= 115011572 && parseInt(targetId) <= 115012586;
                    let winAmount = 0; let hitText = ''; let isWin = false;

                    // çµç®—é‚è¼¯
                    if (['bs', 'oe'].includes(mode)) {
                        let res = '';
                        if (mode === 'bs') {
                            let sm = record.nums.filter(n => n <= 40).length; let bg = record.nums.filter(n => n >= 41).length;
                            res = sm >= 13 ? 'å°' : (bg >= 13 ? 'å¤§' : 'å’Œ');
                        } else {
                            let od = record.nums.filter(n => n % 2 !== 0).length; let ev = record.nums.filter(n => n % 2 === 0).length;
                            res = od >= 13 ? 'å–®' : (ev >= 13 ? 'é›™' : 'å’Œ');
                        }
                        hitText = `é–‹å‡º: ${res}`;
                        if (res === selStr) { isWin = true; winAmount = 150 * mult; }
                    } else if (mode === 'super') {
                        if (record.superNum) {
                            hitText = `é–‹å‡º: ${String(record.superNum).padStart(2,'0')}`;
                            if (record.superNum === selNum[0]) { isWin = true; winAmount = 250 * mult; }
                        } else { hitText = "ç„¡è¶…ç´šçè™Ÿç´€éŒ„"; }
                    } else {
                        let star = parseInt(mode);
                        let hits = selNum.filter(n => record.nums.includes(n));
                        hitText = `å‘½ä¸­ ${hits.length} çƒ`;
                        let basePayout = 0;
                        if (isBonusPeriod && BONUS_TABLE[star] && BONUS_TABLE[star][hits.length] !== undefined) {
                            basePayout = BONUS_TABLE[star][hits.length];
                        } else if (PAY_TABLE[star] && PAY_TABLE[star][hits.length] !== undefined) {
                            basePayout = PAY_TABLE[star][hits.length];
                        }
                        if (basePayout > 0) { isWin = true; winAmount = basePayout * mult; }
                    }

                    totalWin += winAmount;

                    html += `<div class="mb-3 p-3 bg-black/30 rounded-lg border border-white/5">
                        <div class="flex justify-between items-center mb-1">
                            <span class="text-xs font-bold text-gray-300">æœŸæ•¸ ${targetId}</span>
                            ${isBonusPeriod ? '<span class="text-[10px] bg-yellow-600 text-black px-1.5 py-0.5 rounded font-bold">åŠ ç¢¼æœŸé–“</span>' : ''}
                        </div>
                        <div class="flex justify-between text-xs font-bold mt-2">
                            <span class="${isWin ? 'text-green-400' : 'text-gray-500'}">${hitText}</span>
                            <span class="${winAmount > 0 ? 'text-yellow-400' : 'text-gray-600'}">${winAmount > 0 ? 'è´ $'+winAmount.toLocaleString() : 'æœªä¸­ç'}</span>
                        </div>
                    </div>`;
                }
            }
            
            let profit = totalWin - totalCost;
            html += `
                <div class="mt-4 p-4 rounded-xl ${profit > 0 ? 'bg-green-900/30 border border-green-500/50' : 'bg-red-900/30 border border-red-500/50'}">
                    <div class="flex justify-between text-xs text-gray-400 mb-1"><span>æŠ•æ³¨ç¸½é¡</span><span>$${totalCost.toLocaleString()}</span></div>
                    <div class="flex justify-between text-xs text-gray-400 mb-2"><span>ä¸­çç¸½é¡</span><span>$${totalWin.toLocaleString()}</span></div>
                    <div class="flex justify-between text-sm font-black ${profit > 0 ? 'text-green-400' : 'text-red-400'} border-t border-white/10 pt-2">
                        <span>ç¸½æ·¨åˆ©</span><span>${profit > 0 ? '+' : ''}$${profit.toLocaleString()}</span>
                    </div>
                </div>
            `;
            box.innerHTML = html;
        }

        function renderHistory() {
            let h = ''; db.slice(0, 15).forEach(d => {
                let balls = d.nums.map(n => {
                    let isSuper = d.superNum && d.superNum === n;
                    return `<div class="ball ${isSuper ? 'super' : ''}">${String(n).padStart(2,'0')}</div>`;
                }).join('');
                h += `<div class="bg-black/30 p-4 rounded-2xl border border-white/5 space-y-3">
                    <div class="flex justify-between items-center text-[10px] font-black text-gray-500"><span>${d.date} | æœŸæ•¸ ${d.id} | ğŸ•’ ${d.time}</span>${d.bonus ? '<span class="bg-gold px-1.5 rounded text-black font-black text-[8px]">åŠ ç¢¼</span>' : ''}</div>
                    <div class="ball-grid">${balls}</div></div>`;
            });
            document.getElementById('history-list').innerHTML = h || "<div class='text-center p-10 text-gray-500'>å°šæœªé–‹ç</div>";
        }

        function renderStats(type) {
            let counts = {}, gaps = {}, streaks = {};
            for(let i=1; i<=80; i++) { counts[i]=0; gaps[i]=-1; streaks[i]=0; }
            db.forEach((d, idx) => d.nums.forEach(n => { counts[n]++; if(gaps[n]===-1) gaps[n]=idx; }));
            for(let i=1; i<=80; i++) { for(let j=0; j<db.length; j++) { if(db[j].nums.includes(i)) streaks[i]++; else break; } }
            let arr = Object.keys(counts).map(n => ({ n, hot: counts[n], gap: gaps[n], s: streaks[n] }));
            if(type === 'gap') arr.sort((a,b) => b.gap - a.gap);
            else if(type === 'hot') arr.sort((a,b) => b.hot - a.hot);
            else arr.sort((a,b) => b.s - a.s);
            document.getElementById('stats-list').innerHTML = arr.map(x => `
                <tr class="border-b border-white/5 hover:bg-white/5"><td class="py-3 px-1 text-yellow-500 font-bold">${String(x.n).padStart(2,'0')}</td><td>${x.gap} æœŸæœªé–‹</td><td>${x.hot} æ¬¡</td><td>${x.s} é€£é–‹</td></tr>`).join('');
        }

        function renderHistory() {
            let h = ''; db.slice(0, 15).forEach(d => {
                let balls = d.nums.map(n => `<div class="ball">${String(n).padStart(2,'0')}</div>`).join('');
                h += `<div class="bg-black/30 p-4 rounded-2xl border border-white/5 space-y-3">
                    <div class="flex justify-between items-center text-[10px] font-black text-gray-500"><span>${d.date} | æœŸæ•¸ ${d.id} | ğŸ•’ ${d.time}</span>${d.bonus ? '<span class="bg-gold px-1.5 rounded text-black font-black text-[8px]">åŠ ç¢¼</span>' : ''}</div>
                    <div class="ball-grid">${balls}</div></div>`;
            });
            document.getElementById('history-list').innerHTML = h || "<div class='text-center p-10 text-gray-500'>å°šæœªé–‹ç</div>";
        }

        function timer() {
            let n = new Date(); let h = n.getHours(), m = n.getMinutes();
            let bar = document.getElementById('countdown-bar'), lbl = document.getElementById('timer-label');
            if (h < 7 || (h === 7 && m < 5) || (h === 23 && m > 55) || h > 23) {
                document.getElementById('timer').innerText = "ä¼‘å¸‚ä¸­"; lbl.innerText = "BINGO CLOSED"; bar.className = "bg-gray-800 px-4 py-1.5 flex justify-between items-center text-white transition-colors";
            } else {
                let remM = 4 - (m % 5), remS = 59 - n.getSeconds();
                document.getElementById('timer').innerText = `${String(remM).padStart(2,'0')}:${String(remS).padStart(2,'0')}`;
                lbl.innerText = "BINGO COUNTDOWN"; bar.className = "bg-red-600 px-4 py-1.5 flex justify-between items-center text-white transition-colors";
            }
        }

        function show(id) { ['bet','hist','stats'].forEach(x => { document.getElementById(`sec-${x}`).classList.toggle('hidden', x !== id); document.getElementById(`t-${x}`).classList.toggle('active', x === id); }); }
        
        window.onload = init;
    </script>
</body>
</html>
